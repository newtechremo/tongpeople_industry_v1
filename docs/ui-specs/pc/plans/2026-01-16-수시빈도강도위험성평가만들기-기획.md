# 수시 빈도강도 위험성평가 만들기 - 기획 문서

> **원본**: `C:\hongtong\reference\figma\위험성평가 PC관리자\현장통 2.0 PC 관리자 -수시 빈도강도 만들기.mp4`
> **생성일**: 2026-01-16
> **플랫폼**: PC (admin-web)
> **문서 유형**: 기획 문서 (1단계)

---

## 1. 화면 개요

### 1.1 화면 목적
현장 관리자가 **수시 위험성 평가**를 **빈도·강도 방식**으로 작성할 수 있는 화면을 제공합니다. 빈도(5단계)×강도(4단계) 매트릭스를 통해 정량적인 위험 수준을 산정하고, 개선 전후 등급을 비교하여 체계적인 위험 관리를 수행합니다.

### 1.2 사용자
- **주요 사용자**: 현장 관리자 (SITE_ADMIN)
- **사용 빈도**: 수시 (작업 변경, 신규 작업, 사고 발생 시)

### 1.3 접근 경로
```
위험성평가 → 수시 위험성평가 유형 선택 → 빈도·강도 방식 선택 → 폼 작성
```

### 1.4 위험성평가 유형과의 차이점
| 항목 | 최초 위험성평가 | 수시 위험성평가 (본 문서) |
|------|----------------|-------------------------|
| **위험성 수준 방식** | 상·중·하 (3단계) | 빈도·강도 (5×4 매트릭스) |
| **평가 등급** | 직접 선택 | 자동 계산 |
| **개선 후 등급** | 해당 없음 | 빈도·강도 재선택 |
| **확인 여부** | 없음 | 근로자 확인 대상/비확인 선택 |
| **확인 대상 선택** | 없음 | 전체대상/근로자/안전팀 모달 |
| **선택 정보** | 없음 | 순회점검사항, 아차사고 태그 |

---

## 2. 화면 구성

### 2.1 레이아웃 구조
```
┌──────────────────────────────────────────────────────────────┐
│ Header (수시 위험성평가 만들기)                                 │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌────────────────────────────────────────────────────────┐  │
│  │ 기본 정보 섹션                                          │  │
│  │ - 현장명, 소속회사, 결재라인, 근로자대표                   │  │
│  │ - 작업기간 (시작일 ~ 종료일)                             │  │
│  │ - 위험성 수준 (빈도·강도 방식)                           │  │
│  └────────────────────────────────────────────────────────┘  │
│                                                              │
│  ┌────────────────────────────────────────────────────────┐  │
│  │ 대분류① 섹션 (작업 공종)                                 │  │
│  │ - 대분류 검색                                           │  │
│  │ - 소분류 체크리스트                                     │  │
│  │   └── 소분류① 위험요인 작성                             │  │
│  │       - 위험 요인 검색                                  │  │
│  │       - 위험성 수준 (빈도 5단계, 강도 4단계)             │  │
│  │       - 평가 등급 (자동 계산)                           │  │
│  │       - 개선 대책                                       │  │
│  │       - 개선 후 등급 (빈도/강도)                        │  │
│  │       - 확인 여부 (근로자 확인 대상/비확인)              │  │
│  │       - 조치 정보 (조치일, 조치자, 조치확인자, 검토내용) │  │
│  └────────────────────────────────────────────────────────┘  │
│                                                              │
│  ┌────────────────────────────────────────────────────────┐  │
│  │ [+ 작업 공종(대분류) 추가하기] 버튼                       │  │
│  └────────────────────────────────────────────────────────┘  │
│                                                              │
│  ┌────────────────────────────────────────────────────────┐  │
│  │ 선택 정보 입력 섹션                                      │  │
│  │ - 사용/미사용 라디오                                    │  │
│  │ - 순회점검사항 (태그 입력)                               │  │
│  │ - 아차사고 (태그 입력)                                   │  │
│  └────────────────────────────────────────────────────────┘  │
│                                                              │
├──────────────────────────────────────────────────────────────┤
│                   [취소]        [만들기]                      │
└──────────────────────────────────────────────────────────────┘
```

### 2.2 영역별 설명
| 영역 | 설명 |
|------|------|
| Header | 페이지 제목 "수시 위험성평가 만들기" |
| 기본 정보 | 현장명, 소속회사, 결재라인, 근로자대표, 작업기간, 위험성수준 방식 선택 |
| 대분류 섹션 | 작업 공종 선택 및 소분류별 위험요인 작성 (반복 가능) |
| 대분류 추가 | 추가 작업 공종 등록 버튼 |
| 선택 정보 입력 | 순회점검사항, 아차사고 태그 입력 (선택적) |
| Footer | 취소/만들기 버튼 |

---

## 3. 주요 기능

### 3.1 기능 목록
| 기능 | 설명 | 우선순위 |
|------|------|----------|
| 기본 정보 입력 | 현장명, 소속회사, 결재라인, 근로자대표 입력 | 필수 |
| 작업기간 선택 | 캘린더로 시작일/종료일 선택 | 필수 |
| 위험성 수준 방식 선택 | 빈도·강도 방식 선택 | 필수 |
| 대분류 검색 | 작업 공종 검색 및 선택 | 필수 |
| 소분류 다중 선택 | 체크박스로 소분류 다중 선택 | 필수 |
| 위험 요인 입력 | 위험 요인 검색 및 입력 | 필수 |
| 빈도·강도 선택 | 5단계×4단계 라디오 버튼 선택 | 필수 |
| 평가 등급 자동 계산 | 빈도×강도 기반 등급 표시 | 필수 |
| 개선 대책 입력 | 개선 대책 텍스트 입력 | 필수 |
| 개선 후 등급 입력 | 개선 후 빈도·강도 재선택 | 필수 |
| 확인 여부 선택 | 근로자 확인 대상/비확인 선택 | 필수 |
| 확인 대상 선택 | 전체대상/근로자/안전팀 체크박스 모달 | 필수 |
| 조치 정보 입력 | 조치일, 조치자, 조치확인자, 검토내용 | 필수 |
| 결재자 검색 | 소속회사/검색대상 필터 검색 | 필수 |
| 대분류 추가 | 추가 작업 공종 등록 | 필수 |
| 선택 정보 입력 | 순회점검사항, 아차사고 태그 | 선택 |
| 항목 삭제 | 각 항목별 삭제 버튼 | 필수 |

### 3.2 기능 상세

#### 3.2.1 빈도·강도 위험성 수준 선택
**목적**: 정량적 위험 수준 산정을 위한 빈도와 강도 선택

**빈도 (5단계)**:
| 값 | 레이블 | 설명 |
|----|--------|------|
| 5 | 최상 | 매우 빈번히 발생 |
| 4 | 상 | 자주 발생 |
| 3 | 중 | 가끔 발생 |
| 2 | 하 | 드물게 발생 |
| 1 | 최하 | 거의 발생하지 않음 |

**강도 (4단계)**:
| 값 | 레이블 | 설명 |
|----|--------|------|
| 4 | 최대 | 사망/영구장해 |
| 3 | 대 | 중상/휴업 |
| 2 | 중 | 경상/응급처치 |
| 1 | 소 | 무상해/불편 |

**평가 등급 자동 계산**:
```
위험점수 = 빈도 × 강도

등급 산정:
- 고등급 (긴급 조치): 16-20점
- 중등급 (점검 관리): 8-15점
- 하등급 (일상 관리): 1-7점
```

#### 3.2.2 확인 여부 대상 선택
**목적**: 위험요인 확인 대상자 그룹 선택

**동작 흐름**:
1. "근로자 확인 대상" 라디오 선택 시 "+대상 선택하기" 버튼 활성화
2. 버튼 클릭 시 "확인 여부 대상 선택" 모달 표시
3. 체크박스로 대상 선택 (전체대상/근로자/안전팀)
4. "선택 완료" 클릭 시 적용

#### 3.2.3 결재자 검색 모달
**목적**: 결재라인 및 조치자/조치확인자 검색

**필터 옵션**:
- **소속 회사**: 시공사 / 협력사
- **검색 대상**: 관리자

**동작 흐름**:
1. 검색 아이콘 클릭 시 모달 표시
2. 소속회사, 검색대상 필터 선택
3. 검색어 입력 시 실시간 필터링
4. 항목 선택 후 "선택 완료" 클릭

#### 3.2.4 선택 정보 입력
**목적**: 부가 정보 태그 형식 입력

**순회점검사항**:
- 입력 필드에 텍스트 입력 후 "추가하기" 클릭
- 태그 형식으로 표시 (예: "-참고용")
- X 버튼으로 삭제 가능

**아차사고**:
- 동일한 방식으로 태그 추가
- 태그 형식으로 표시 (예: "-아차방지용")

---

## 4. 데이터 흐름

### 4.1 API 엔드포인트
| 메서드 | 엔드포인트 | 설명 |
|--------|------------|------|
| GET | `/api/sites/:siteId` | 현장 정보 조회 |
| GET | `/api/sites/:siteId/users` | 현장 사용자 목록 (결재자, 조치자) |
| GET | `/api/risk-categories` | 대분류 목록 조회 |
| GET | `/api/risk-categories/:categoryId/subcategories` | 소분류 목록 조회 |
| GET | `/api/risk-factors` | 위험요인 검색 |
| POST | `/api/risk-assessments/adhoc` | 수시 위험성평가 생성 |
| GET | `/api/risk-assessments/adhoc/:id` | 수시 위험성평가 상세 조회 |
| PUT | `/api/risk-assessments/adhoc/:id` | 수시 위험성평가 수정 |

### 4.2 데이터 모델
```typescript
// 수시 위험성평가 (빈도·강도 방식)
interface AdHocRiskAssessment {
  id: number;
  site_id: number;
  assessment_type: 'ADHOC';
  risk_level_method: 'FREQUENCY_INTENSITY';  // 빈도·강도 방식

  // 기본 정보
  company_name: string;
  approval_line: ApprovalUser[];
  worker_representative: string;
  work_period_start: string;  // YYYY-MM-DD
  work_period_end: string;    // YYYY-MM-DD

  // 작업 공종 (대분류)
  categories: AdHocCategory[];

  // 선택 정보
  optional_info_enabled: boolean;
  patrol_check_items: string[];   // 순회점검사항 태그
  near_miss_items: string[];      // 아차사고 태그

  status: 'DRAFT' | 'IN_PROGRESS' | 'COMPLETED';
  created_at: string;
  updated_at: string;
}

// 대분류 (작업 공종)
interface AdHocCategory {
  id: number;
  category_id: number;
  category_name: string;
  subcategories: AdHocSubcategory[];
}

// 소분류
interface AdHocSubcategory {
  id: number;
  subcategory_id: number;
  subcategory_name: string;
  risk_factors: AdHocRiskFactor[];
}

// 위험요인 (빈도·강도 방식)
interface AdHocRiskFactor {
  id: number;
  risk_factor_id: number;
  risk_factor_name: string;

  // 위험성 수준 (개선 전)
  frequency_before: 1 | 2 | 3 | 4 | 5;   // 빈도
  intensity_before: 1 | 2 | 3 | 4;        // 강도
  grade_before: string;                    // 자동 계산 (고등급/중등급/하등급)

  // 개선 대책
  improvement_measure: string;

  // 위험성 수준 (개선 후)
  frequency_after: 1 | 2 | 3 | 4 | 5;
  intensity_after: 1 | 2 | 3 | 4;
  grade_after: string;

  // 확인 여부
  confirmation_type: 'WORKER_CONFIRM' | 'WORKER_NO_CONFIRM';
  confirmation_targets: ('ALL' | 'WORKER' | 'SAFETY_TEAM')[];

  // 조치 정보
  action_date: string;
  action_person_id: number;
  action_person_name: string;
  action_verifier_id: number;
  action_verifier_name: string;
  review_content: string;
}

// 빈도·강도 등급 계산 유틸
type FrequencyLevel = 1 | 2 | 3 | 4 | 5;
type IntensityLevel = 1 | 2 | 3 | 4;
type RiskGrade = '고등급 (긴급 조치)' | '중등급 (점검 관리)' | '하등급 (일상 관리)';

function calculateRiskGrade(frequency: FrequencyLevel, intensity: IntensityLevel): RiskGrade {
  const score = frequency * intensity;
  if (score >= 16) return '고등급 (긴급 조치)';
  if (score >= 8) return '중등급 (점검 관리)';
  return '하등급 (일상 관리)';
}
```

### 4.3 상태 관리
- **서버 상태**: React Query (`useQuery`, `useMutation`)
- **폼 상태**: React Hook Form + Zod validation
- **로컬 상태**: `useState` (모달 열림, 선택 항목 등)

---

## 5. 사용자 시나리오

### 5.1 시나리오 1: 수시 위험성평가 작성
**사용자**: 현장 관리자
**목적**: 신규 작업에 대한 수시 위험성평가 작성

| 단계 | 사용자 액션 | 시스템 응답 |
|------|------------|-------------|
| 1 | 위험성평가 유형에서 "수시" 선택 | 수시 위험성평가 폼 표시 |
| 2 | 기본 정보 입력 (현장명, 소속회사 등) | 입력값 저장 |
| 3 | 작업기간 날짜 선택 | 캘린더 팝업, 날짜 적용 |
| 4 | "빈도·강도" 방식 선택 | 빈도·강도 입력 UI로 전환 |
| 5 | 대분류 검색 후 선택 | 소분류 체크리스트 표시 |
| 6 | 소분류 체크박스 선택 | 선택된 소분류별 위험요인 입력 영역 생성 |
| 7 | 위험 요인 검색 및 선택 | 위험 요인 텍스트 적용 |
| 8 | 빈도(상-4) 선택 | 빈도 라디오 버튼 선택 |
| 9 | 강도(대-3) 선택 | 강도 라디오 버튼 선택 |
| 10 | - | 평가 등급 "중등급 (점검 관리)" 자동 표시 |
| 11 | 개선 대책 입력 | 텍스트 저장 |
| 12 | 개선 후 빈도(중-3), 강도(중-2) 선택 | 개선 후 등급 "하등급 (일상 관리)" 자동 표시 |
| 13 | "근로자 확인 대상" 선택 | "+대상 선택하기" 버튼 활성화 |
| 14 | 확인 대상 선택 (전체대상 체크) | 대상 태그 표시 |
| 15 | 조치일 선택, 조치자/조치확인자 검색 선택 | 담당자 정보 적용 |
| 16 | 검토 내용 입력 후 "추가하기" 클릭 | 검토 내용 태그 추가 |
| 17 | "만들기" 버튼 클릭 | 저장 후 목록으로 이동 |

### 5.2 시나리오 2: 다중 대분류 추가
**사용자**: 현장 관리자
**목적**: 여러 작업 공종에 대한 위험성평가 동시 작성

| 단계 | 사용자 액션 | 시스템 응답 |
|------|------------|-------------|
| 1 | 대분류① 작성 완료 후 | 대분류① 섹션 완료 |
| 2 | "+ 작업 공종(대분류) 추가하기" 클릭 | 대분류② 섹션 추가 |
| 3 | 대분류② 검색 드롭다운 열기 | 대분류 목록 표시 (직접 입력하기 포함) |
| 4 | 대분류 선택 | 소분류 체크리스트 표시 |
| 5 | 소분류 다중 선택 | 선택된 소분류별 위험요인 입력 영역 생성 |
| 6 | 각 소분류별 위험요인 작성 | 저장 |
| 7 | "대분류 삭제" 클릭 | 해당 대분류 섹션 삭제 |

### 5.3 시나리오 3: 선택 정보 입력
**사용자**: 현장 관리자
**목적**: 순회점검사항, 아차사고 정보 추가

| 단계 | 사용자 액션 | 시스템 응답 |
|------|------------|-------------|
| 1 | 선택 정보 입력 "사용" 선택 | 순회점검사항, 아차사고 입력란 활성화 |
| 2 | 순회점검사항 입력 "참고용" | 입력 필드에 텍스트 |
| 3 | "추가하기" 버튼 클릭 | "-참고용" 태그 추가 |
| 4 | 아차사고 입력 "아차방지용" | 입력 필드에 텍스트 |
| 5 | "추가하기" 버튼 클릭 | "-아차방지용" 태그 추가 |
| 6 | 태그의 X 버튼 클릭 | 해당 태그 삭제 |

---

## 6. 비즈니스 로직

### 6.1 규칙
| 규칙 | 설명 |
|------|------|
| 빈도·강도 필수 | 모든 위험요인에 빈도와 강도 필수 선택 |
| 평가 등급 자동 계산 | 빈도×강도 점수에 따라 자동 등급 산정 |
| 개선 후 등급 필수 | 개선 대책 입력 시 개선 후 빈도·강도 필수 |
| 확인 여부 필수 | 근로자 확인 대상/비확인 중 하나 필수 선택 |
| 조치 정보 필수 | 조치일, 조치자, 조치확인자 필수 |
| 대분류 최소 1개 | 최소 1개 이상의 대분류(작업 공종) 필수 |
| 소분류 최소 1개 | 각 대분류당 최소 1개 이상의 소분류 선택 필수 |

### 6.2 검증
| 필드 | 검증 규칙 |
|------|----------|
| 현장명 | 필수, 자동 표시 (현재 현장) |
| 소속회사 | 필수 |
| 작업기간 | 필수, 종료일 >= 시작일 |
| 빈도 | 필수, 1-5 범위 |
| 강도 | 필수, 1-4 범위 |
| 개선 대책 | 필수, 최대 500자 |
| 확인 여부 | 필수, 둘 중 하나 선택 |
| 조치일 | 필수, 유효한 날짜 |
| 조치자 | 필수, 사용자 선택 |
| 조치확인자 | 필수, 사용자 선택 |

---

## 7. 예외 처리

### 7.1 에러 상태
| 상태 | 원인 | 사용자 메시지 | 처리 |
|------|------|--------------|------|
| 저장 실패 | 네트워크 오류 | "저장에 실패했습니다. 다시 시도해주세요." | 재시도 버튼 |
| 필수값 누락 | 유효성 검사 실패 | 해당 필드 에러 표시 | 필드 포커스 |
| 대분류 없음 | 대분류 미선택 | "최소 1개의 작업 공종을 선택해주세요." | 대분류 영역 강조 |
| 권한 없음 | 접근 권한 부족 | "접근 권한이 없습니다." | 이전 페이지 |

### 7.2 경계 조건
- 대분류가 10개 이상인 경우 → 스크롤 처리
- 소분류가 20개 이상인 경우 → 스크롤 처리
- 위험요인 검색 결과가 없는 경우 → "직접 입력하기" 옵션 제공
- 사용자 검색 결과가 없는 경우 → 빈 상태 표시

---

## 8. 모달 정의

### 8.1 확인 여부 대상 선택 모달
**트리거**: "근로자 확인 대상" 선택 후 "+대상 선택하기" 버튼 클릭

**구성**:
```
┌─────────────────────────────────────┐
│ 확인 여부 대상 선택              ✕  │
├─────────────────────────────────────┤
│                                     │
│  ☐ 전체대상                         │
│  ☐ 근로자                           │
│  ☐ 안전팀                           │
│                                     │
├─────────────────────────────────────┤
│         [취소]    [선택 완료]        │
└─────────────────────────────────────┘
```

### 8.2 결재자 검색 모달
**트리거**: 결재라인 변경, 조치자, 조치확인자 검색 아이콘 클릭

**구성**:
```
┌─────────────────────────────────────┐
│ 결재자 검색                      ✕  │
├─────────────────────────────────────┤
│ 소속 회사   ● 시공사  ○ 협력사      │
│                                     │
│ 검색 대상   ● 관리자                │
│                                     │
│ [결재자 이름으로 검색해주세요... 🔍] │
│                                     │
├─────────────────────────────────────┤
│         [취소]      [다음]          │
└─────────────────────────────────────┘
```

### 8.3 조치확인자 선택 모달
**트리거**: 조치확인자 검색 아이콘 클릭

**구성**:
```
┌─────────────────────────────────────┐
│ 조치확인자 선택                  ✕  │
├─────────────────────────────────────┤
│ [조치확인자 이름으로 검색해주세요 🔍]│
│                                     │
│ ○ 공공팔 (시공사-(주)통하는사람들/안전기사)    │
│ ○ 공공사 (시공사-(주)통하는사람들/공사기사)    │
│ ○ 0017 (시공사-(주)통하는사람들/보건관리자)   │
│ ○ 공공이 (시공사-(주)통하는사람들/철근)       │
│ ○ 고삼욱 (시공사-(주)통하는사람들/공무사원)   │
│ ○ 0006 (시공사-(주)통하는사람들/보통인부)     │
│ ○ 민병대 (시공사-(주)통하는사람들/품질차장)   │
│                                 ▼   │
├─────────────────────────────────────┤
│         [취소]    [선택 완료]        │
└─────────────────────────────────────┘
```

---

## 9. 참고 화면

### 9.1 유사 기존 화면
| 화면 | 경로 | 참고 포인트 |
|------|------|-------------|
| 최초 위험성평가 만들기 | `src/pages/risk-assessment/InitialAssessmentForm.tsx` | 기본 구조, 대분류/소분류 선택 |
| 위험성평가 목록 | `src/pages/RiskAssessmentPage.tsx` | 유형 선택, 라우팅 |

### 9.2 레퍼런스 이미지
- 원본: `C:\hongtong\reference\figma\위험성평가 PC관리자\현장통 2.0 PC 관리자 -수시 빈도강도 만들기.mp4`
- 프레임: `C:\hongtong\reference\figma\위험성평가 PC관리자\frames2\` (21개 프레임)

---

## 10. 구현 명세서 연결

**다음 단계**: 구현 명세서 생성

저장 위치: `docs/ui-specs/pc/specs/2026-01-16-수시빈도강도위험성평가만들기-구현.md`
