# 최초 위험성평가 만들기 - 기획 문서

> **원본**: `C:\hongtong\reference\figma\위험성평가 PC관리자\현장통 최초 만들기 영상.mp4`
> **생성일**: 2026-01-16
> **플랫폼**: PC (admin-web)
> **문서 유형**: 기획 문서 (1단계)

---

## 1. 화면 개요

### 1.1 화면 목적
현장 관리자가 최초 위험성평가를 작성하는 화면. 작업 공종별로 위험 요인을 식별하고 개선 대책을 수립하여 안전한 작업 환경을 조성한다.

### 1.2 사용자
- **주요 사용자**: 현장 관리자 (SITE_ADMIN)
- **사용 빈도**: 프로젝트 시작 시 1회, 이후 정기 위험성평가로 전환

### 1.3 접근 경로
```
위험성 평가 → 위험성 평가 목록 → "위험성평가 만들기" 버튼 클릭
```

**URL**: `/initialRiskAssessment`

---

## 2. 화면 구성

### 2.1 레이아웃 구조
```
┌──────────────────────────────────────────────────────────────────┐
│ Header: 위험성 평가 > 위험성 평가 (Breadcrumb)                      │
├──────────────────────────────────────────────────────────────────┤
│ ◀ ④ 최초 위험성 평가 (만들기부터)                                   │
├──────────────────────────────────────────────────────────────────┤
│ ┌─ 기본 정보 ──────────────────────────────────────────────────┐ │
│ │ 현장명:     [통사통사현장]                                    │ │
│ │ 소속 회사:  [시공사·(주)통하는사람들]                          │ │
│ │ 결재 라인:  ● 1  ○ 결재라인 변경                              │ │
│ │ ┌────────────┬────────────┐                                 │ │
│ │ │ 근로자 대표  │     0      │                                 │ │
│ │ │     36     │   0017     │                                 │ │
│ │ └────────────┴────────────┘                                 │ │
│ │ 작업 기간:  [26-01-01] ~ [26-01-31]                          │ │
│ │ 위험성 수준: 상·중·하 - 위험성 수준을 [상·중·하] 3단계 선택      │ │
│ └─────────────────────────────────────────────────────────────┘ │
├──────────────────────────────────────────────────────────────────┤
│ ┌─ 작업 공종 ──────────────────────────────────────────────────┐ │
│ │ 대분류①: [🔍 가설전선 설치 ×]           [대분류 삭제]          │ │
│ │ ┌─ 소분류 선택 (한 개 이상 선택하세요) ─┐                      │ │
│ │ │ ☑ 가설전선 설치작업                  │                      │ │
│ │ │ ☐ 가설전선 점검작업                  │                      │ │
│ │ │ ☐ 꽂음 접속기작업                    │                      │ │
│ │ │ ☐ 이동형 릴 전선작업                 │                      │ │
│ │ │ ☐ 전동공구 사용/정리정돈작업          │                      │ │
│ │ │ ⊕ 소분류 직접 추가                   │                      │ │
│ │ └────────────────────────────────────┘                      │ │
│ │ ┌─ 소분류① 가설전선 설치작업 ──────────────────────── ×  ─┐  │ │
│ │ │ 위험 요인 작성  ⊕ 추가하기                               │  │ │
│ │ │ ┌──────────────────────────────────────────────────┐  │  │ │
│ │ │ │ 위험 요인: [안전대를 사용하지 않고 고소부위 작업중 추락] 🔍│  │ │
│ │ │ │ 위험성 수준: ○ 상  ● 중  ○ 하                       │  │  │ │
│ │ │ │ 개선 대책: [고소부위 작업시 안전대 고리 체결 철저]      │  │  │ │
│ │ │ │ 작업 기간: [26-01-01] ~ [26-01-31]                  │  │  │ │
│ │ │ │                                      [항목 삭제]    │  │  │ │
│ │ │ └──────────────────────────────────────────────────┘  │  │ │
│ │ └───────────────────────────────────────────────────────┘  │ │
│ │                                                             │ │
│ │ 대분류②: [🔍 대분류를 입력하세요...]        [대분류 삭제]       │ │
│ │                   ⊕ 작업 공종(대분류) 추가하기                 │ │
│ └─────────────────────────────────────────────────────────────┘ │
├──────────────────────────────────────────────────────────────────┤
│            [취소]                          [만들기]               │
└──────────────────────────────────────────────────────────────────┘
```

### 2.2 영역별 설명
| 영역 | 설명 |
|------|------|
| Header | 브레드크럼 네비게이션, 뒤로가기 버튼 |
| 기본 정보 | 현장명, 소속 회사, 결재 라인, 근로자 대표, 작업 기간, 위험성 수준 |
| 작업 공종 | 대분류/소분류 선택, 위험 요인 입력, 개선 대책 작성 |
| 하단 버튼 | 취소, 만들기 |

---

## 3. 주요 기능

### 3.1 기능 목록
| 기능 | 설명 | 우선순위 |
|------|------|----------|
| 기본 정보 표시 | 현장명, 소속 회사 자동 표시 | 필수 |
| 결재 라인 선택 | 1명 또는 변경 가능 | 필수 |
| 작업 기간 선택 | 시작일 ~ 종료일 날짜 선택 | 필수 |
| 대분류 검색/선택 | 작업 공종 대분류 검색 및 선택 | 필수 |
| 소분류 선택 | 체크박스로 복수 선택 | 필수 |
| 소분류 직접 추가 | 모달로 커스텀 소분류 입력 | 필수 |
| 위험 요인 입력 | 검색 또는 직접 입력 | 필수 |
| 위험성 수준 선택 | 상/중/하 라디오 버튼 | 필수 |
| 개선 대책 입력 | 텍스트 입력 | 필수 |
| 위험 요인 추가/삭제 | 복수 위험 요인 관리 | 필수 |
| 대분류 추가/삭제 | 복수 작업 공종 관리 | 필수 |

### 3.2 기능 상세

#### 3.2.1 대분류 검색/선택
**목적**: 작업 공종의 대분류를 선택

**동작 흐름**:
1. 검색 입력창에 키워드 입력
2. 드롭다운에 매칭되는 대분류 목록 표시
3. 항목 클릭 시 선택

**예시 대분류**:
- 가설전선 설치
- 흙막이 Earth Anchor
- 흙막이 CIP
- 흙막이 S.C.W
- 흙막이 SLURRY WALL

#### 3.2.2 소분류 선택
**목적**: 대분류 내 세부 작업 선택

**동작 흐름**:
1. 대분류 선택 시 관련 소분류 체크박스 리스트 표시
2. 복수 선택 가능
3. 선택 시 하단에 위험 요인 입력 폼 표시

**예시 소분류** (가설전선 설치):
- 가설전선 설치작업
- 가설전선 점검작업
- 꽂음 접속기작업
- 이동형 릴 전선작업
- 전동공구 사용/정리정돈작업

#### 3.2.3 소분류 직접 추가
**목적**: 목록에 없는 커스텀 소분류 추가

**동작 흐름**:
1. "소분류 직접 추가" 버튼 클릭
2. 모달 팝업 (텍스트 입력)
3. "추가하기" 클릭 시 체크박스 리스트에 추가 (자동 체크됨)

#### 3.2.4 위험 요인 입력
**목적**: 해당 작업의 위험 요인 식별

**입력 방식**:
1. **검색 선택**: 돋보기 아이콘 클릭 → 위험요인 선택 모달
2. **직접 입력**: 텍스트 필드에 직접 입력

**위험요인 선택 모달**:
- 대분류/소분류 표시
- 미리 정의된 위험요인 목록
- 체크박스 선택 후 "선택 완료"

**예시 위험 요인**:
- 안전대를 사용하지 않고 고소부위 작업중 추락
- 장비 추진시 유도자 미배치로 인한 충돌 협착
- 되메우기 작업중 하부의 근로자 인지 못한 채 작업중 토사에 매몰사고
- 가시설 해체시 사면 붕괴
- 굴삭기 기계장치 연결부 탈락에 의해 재해

#### 3.2.5 위험성 수준 선택
**목적**: 위험의 심각도 평가

**옵션**:
- **상**: 높은 위험 (빨간색)
- **중**: 중간 위험 (주황색)
- **하**: 낮은 위험 (초록색)

#### 3.2.6 개선 대책 입력
**목적**: 위험 요인에 대한 대응책 수립

**예시**:
- 고소부위 작업시 안전대 고리 체결 철저
- 가시설 해체전 사면의 상태 확인 보강작업 실시

---

## 4. 데이터 흐름

### 4.1 API 엔드포인트
| 메서드 | 엔드포인트 | 설명 |
|--------|------------|------|
| GET | `/api/risk-categories` | 대분류 목록 조회 |
| GET | `/api/risk-categories/:id/subcategories` | 소분류 목록 조회 |
| GET | `/api/risk-factors?category=:id&subcategory=:id` | 위험 요인 목록 조회 |
| POST | `/api/risk-assessments` | 위험성 평가 생성 |
| GET | `/api/sites/:id` | 현장 정보 조회 |
| GET | `/api/approval-lines` | 결재 라인 조회 |

### 4.2 데이터 모델
```typescript
interface RiskAssessment {
  id: number;
  site_id: number;
  company_id: number;
  assessment_type: 'INITIAL' | 'REGULAR';
  work_period_start: string;
  work_period_end: string;
  approval_line_id: number;
  risk_level: 'HIGH' | 'MEDIUM' | 'LOW';
  status: 'DRAFT' | 'PENDING' | 'APPROVED' | 'REJECTED';
  created_at: string;
  updated_at: string;
}

interface RiskAssessmentItem {
  id: number;
  assessment_id: number;
  category_id: number;        // 대분류
  subcategory_id: number;     // 소분류
  risk_factor: string;        // 위험 요인
  risk_level: 'HIGH' | 'MEDIUM' | 'LOW';
  improvement_measure: string; // 개선 대책
  work_period_start: string;
  work_period_end: string;
}
```

### 4.3 상태 관리
- **서버 상태**: React Query
  - 대분류/소분류/위험요인 목록: `useQuery`
  - 위험성평가 생성: `useMutation`
- **로컬 상태**: `useState`
  - 선택된 대분류/소분류
  - 입력된 위험 요인 목록
  - 모달 열림 상태
  - 폼 데이터

---

## 5. 사용자 시나리오

### 5.1 시나리오 1: 기본 위험성평가 작성
**사용자**: 현장 관리자
**목적**: 최초 위험성평가 등록

| 단계 | 사용자 액션 | 시스템 응답 |
|------|------------|-------------|
| 1 | 목록에서 "위험성평가 만들기" 클릭 | 작성 폼 화면 표시 |
| 2 | 작업 기간 선택 | 날짜 피커 동작 |
| 3 | 대분류 검색 "가설전선" 입력 | 드롭다운에 결과 표시 |
| 4 | "가설전선 설치" 선택 | 소분류 리스트 표시 |
| 5 | 소분류 "가설전선 설치작업" 체크 | 위험 요인 입력 폼 표시 |
| 6 | 위험 요인 입력 또는 검색 | 입력값 저장 |
| 7 | 위험성 수준 "중" 선택 | 라디오 버튼 활성화 |
| 8 | 개선 대책 입력 | 입력값 저장 |
| 9 | "만들기" 버튼 클릭 | 로딩 → 성공 모달 표시 |
| 10 | "확인" 클릭 | 목록 화면으로 이동 |

### 5.2 시나리오 2: 커스텀 소분류 추가
**사용자**: 현장 관리자
**목적**: 목록에 없는 작업 추가

| 단계 | 사용자 액션 | 시스템 응답 |
|------|------------|-------------|
| 1 | 대분류 선택 후 | 소분류 리스트 표시 |
| 2 | "소분류 직접 추가" 클릭 | 모달 팝업 |
| 3 | 커스텀 소분류명 입력 | 입력 필드 활성화 |
| 4 | "추가하기" 클릭 | 모달 닫힘, 리스트에 추가 |

### 5.3 시나리오 3: 복수 대분류 추가
**사용자**: 현장 관리자
**목적**: 여러 작업 공종 등록

| 단계 | 사용자 액션 | 시스템 응답 |
|------|------------|-------------|
| 1 | 첫 번째 대분류 작성 완료 | 대분류① 표시 |
| 2 | "작업 공종(대분류) 추가하기" 클릭 | 대분류② 입력 필드 추가 |
| 3 | 두 번째 대분류 선택 | 소분류 리스트 표시 |

---

## 6. 비즈니스 로직

### 6.1 규칙
| 규칙 | 설명 |
|------|------|
| 필수 입력 | 작업 기간, 대분류 1개 이상, 소분류 1개 이상, 위험 요인 1개 이상 |
| 날짜 제한 | 시작일은 종료일 이전이어야 함 |
| 위험 요인 | 소분류당 최소 1개 위험 요인 필요 |

### 6.2 검증
| 필드 | 검증 규칙 |
|------|----------|
| 작업 기간 시작일 | 필수, 날짜 형식 |
| 작업 기간 종료일 | 필수, 시작일 이후 |
| 대분류 | 최소 1개 선택 |
| 소분류 | 대분류당 최소 1개 선택 |
| 위험 요인 | 소분류당 최소 1개 입력 |
| 위험성 수준 | 필수 선택 (상/중/하) |
| 개선 대책 | 필수 입력 |

---

## 7. 예외 처리

### 7.1 에러 상태
| 상태 | 원인 | 사용자 메시지 | 처리 |
|------|------|--------------|------|
| 저장 실패 | 네트워크 오류 | "저장에 실패했습니다. 다시 시도해주세요." | 재시도 버튼 |
| 검증 실패 | 필수 입력 누락 | 해당 필드 에러 표시 | 스크롤 이동 |
| 권한 없음 | 비권한자 접근 | "접근 권한이 없습니다." | 목록으로 이동 |

### 7.2 경계 조건
- 대분류/소분류 검색 결과가 없는 경우 → "결과가 없습니다" 표시
- 위험 요인 검색 결과가 없는 경우 → "직접 입력하기" 안내
- 모든 대분류 삭제 시 → 최소 1개 필요 경고

---

## 8. 모달 목록

### 8.1 소분류 직접 추가 모달
| 항목 | 내용 |
|------|------|
| 제목 | 소분류 직접 추가하기 |
| 내용 | 텍스트 입력 필드 |
| 버튼 | 취소, 추가하기 |

### 8.2 위험요인 선택 모달
| 항목 | 내용 |
|------|------|
| 제목 | 위험요인 선택 |
| 내용 | 대분류, 소분류 표시 + 위험요인 체크박스 리스트 |
| 버튼 | 취소, 선택 완료 |

### 8.3 완료 모달
| 항목 | 내용 |
|------|------|
| 제목 | 위험성 평가 작성 완료! |
| 내용 | 위험성 평가가 성공적으로 등록되었습니다. |
| 버튼 | 확인 |

---

## 9. 화면 전이

```
[위험성평가 목록]
       │
       ▼ "위험성평가 만들기" 클릭
[최초 위험성평가 만들기]
       │
       ├── "취소" 클릭 ──► [위험성평가 목록]
       │
       └── "만들기" 클릭
              │
              ▼
       [로딩 상태]
              │
              ▼
       [완료 모달]
              │
              ▼ "확인" 클릭
       [위험성평가 목록]
```

---

## 10. 참고 화면

### 10.1 프레임 캡처
| 프레임 | 시간 | 화면 |
|--------|------|------|
| frame_001 | 0초 | 위험성평가 목록 |
| frame_002 | 5초 | 기본 정보 입력 (상단) |
| frame_003 | 10초 | 작업 공종 섹션 (하단) |
| frame_004~006 | 15~25초 | 소분류 선택 및 위험 요인 입력 |
| frame_007 | 30초 | 소분류 직접 추가 모달 |
| frame_008~011 | 35~50초 | 복수 소분류/대분류 추가 |
| frame_012 | 55초 | 대분류 검색 드롭다운 |
| frame_013 | 60초 | 위험요인 선택 모달 |
| frame_014 | 65초 | 로딩 상태 |
| frame_015 | 70초 | 완료 모달 |

### 10.2 레퍼런스 경로
- 원본 동영상: `C:\hongtong\reference\figma\위험성평가 PC관리자\현장통 최초 만들기 영상.mp4`
- 추출 프레임: `C:\hongtong\reference\figma\위험성평가 PC관리자\frames\`

---

## 11. 구현 명세서 연결

**다음 단계**: 구현 명세서 생성
```bash
/ui-spec "C:\hongtong\reference\figma\위험성평가 PC관리자\현장통 최초 만들기 영상.mp4" --platform pc --step spec
```

저장 위치: `docs/ui-specs/pc/specs/2026-01-16-최초위험성평가만들기-구현.md`
