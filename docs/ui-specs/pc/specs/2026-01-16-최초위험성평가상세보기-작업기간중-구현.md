# ìµœì´ˆ ìœ„í—˜ì„±í‰ê°€ ìƒì„¸ë³´ê¸° (ì‘ì—…ê¸°ê°„ì¤‘) - êµ¬í˜„ ëª…ì„¸ì„œ

> **ì›ë³¸**: `C:\hongtong\reference\figma\ìœ„í—˜ì„±í‰ê°€ PCê´€ë¦¬ì\í˜„ì¥í†µ 2.0 PC ê´€ë¦¬ì -ìœ„í—˜ì„±í‰ê°€ ë¬¸ì„œ ìƒì„¸ë³´ê¸° ë° ìˆ˜ì‹œ ìƒì„¸ë³´ê¸°ì—ì„œ ì¶”ê°€ í™”ë©´.mp4`
> **ìƒì„±ì¼**: 2026-01-16
> **í”Œë«í¼**: PC (admin-web)
> **ë¬¸ì„œ ìœ í˜•**: êµ¬í˜„ ëª…ì„¸ì„œ (2ë‹¨ê³„)
> **ê¸°íš ë¬¸ì„œ**: `docs/ui-specs/pc/plans/2026-01-16-ìµœì´ˆìœ„í—˜ì„±í‰ê°€ìƒì„¸ë³´ê¸°-ì‘ì—…ê¸°ê°„ì¤‘-ê¸°íš.md`

---

## 1. ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°

### 1.1 íŒŒì¼ êµ¬ì¡° (ì¶”ê°€/ìˆ˜ì • ì»´í¬ë„ŒíŠ¸)

```
src/
â”œâ”€â”€ components/
â”‚   â””â”€â”€ risk-assessment/
â”‚       â””â”€â”€ detail/
â”‚           â”œâ”€â”€ ApprovalLineEditable.tsx       # ê²°ì¬ ë¼ì¸ (ìˆ˜ì • ê°€ëŠ¥) âœ¨ ì‹ ê·œ
â”‚           â”œâ”€â”€ ApproverEditModal.tsx          # ê²°ì¬ì ìˆ˜ì • ëª¨ë‹¬ âœ¨ ì‹ ê·œ
â”‚           â””â”€â”€ ApproverSearchInput.tsx        # ê²°ì¬ì ê²€ìƒ‰ ì…ë ¥ âœ¨ ì‹ ê·œ
â””â”€â”€ hooks/
    â””â”€â”€ risk-assessment/
        â””â”€â”€ useApproverManagement.ts           # ê²°ì¬ì ê´€ë¦¬ í›… âœ¨ ì‹ ê·œ
```

### 1.2 ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ (ì‘ì—…ê¸°ê°„ì¤‘)

```
InitialAssessmentDetailPage
â”œâ”€â”€ AssessmentDetailHeader
â”‚   â”œâ”€â”€ ExportDropdown
â”‚   â”œâ”€â”€ DeleteButton
â”‚   â””â”€â”€ EditButton                    # âœ¨ ì‘ì—…ê¸°ê°„ì¤‘ë§Œ í‘œì‹œ
â”œâ”€â”€ AssessmentBasicInfo
â”œâ”€â”€ ApprovalLineEditable              # âœ¨ ì‘ì—…ê¸°ê°„ì¤‘ìš© (ìˆ˜ì • ê°€ëŠ¥)
â”‚   â”œâ”€â”€ ApproverCard[]
â”‚   â””â”€â”€ EditIcon (ì—°í•„ ì•„ì´ì½˜)
â”œâ”€â”€ RiskFactorCardList
â”‚   â””â”€â”€ RiskFactorCard[]
â”œâ”€â”€ ApproverEditModal                 # âœ¨ ê²°ì¬ì ìˆ˜ì • ëª¨ë‹¬
â”‚   â””â”€â”€ ApproverSearchInput
â””â”€â”€ DeleteConfirmModal
```

---

## 2. ì»´í¬ë„ŒíŠ¸ ë§¤í•‘

### 2.1 ë§¤í•‘ ê²°ê³¼ ìš”ì•½

| ìƒíƒœ | ê°œìˆ˜ |
|------|------|
| âœ… ê¸°ì¡´ ì‚¬ìš© | 5ê°œ |
| ğŸ†• ì‹ ê·œ í•„ìš” | 4ê°œ |
| âš ï¸ ìˆ˜ì • í•„ìš” | 1ê°œ |

### 2.2 ìƒì„¸ ë§¤í•‘

| UI ìš”ì†Œ | ìƒíƒœ | ì»´í¬ë„ŒíŠ¸ | ê²½ë¡œ |
|---------|------|----------|------|
| í˜ì´ì§€ ë ˆì´ì•„ì›ƒ | âœ… | ê¸°ì¡´ Layout | `src/App.tsx` |
| ì‚¬ì´ë“œë°” | âœ… | `Sidebar` | `src/components/Sidebar.tsx` |
| í—¤ë” | âœ… | `Header` | `src/components/Header.tsx` |
| ì•„ì´ì½˜ (lucide) | âœ… | Edit2, Search ë“± | `lucide-react` |
| ê²°ì¬ ë¼ì¸ ì„¤ì • ì°¸ì¡° | âœ… | `ApprovalLineSettings` | `src/components/settings/ApprovalLineSettings.tsx` |
| ìƒì„¸ í—¤ë” | âš ï¸ | `AssessmentDetailHeader` | ìˆ˜ì • í•„ìš” (onEdit ì¶”ê°€) |
| ê²°ì¬ ë¼ì¸ (í¸ì§‘) | ğŸ†• | `ApprovalLineEditable` | - |
| ê²°ì¬ì ìˆ˜ì • ëª¨ë‹¬ | ğŸ†• | `ApproverEditModal` | - |
| ê²°ì¬ì ê²€ìƒ‰ | ğŸ†• | `ApproverSearchInput` | - |
| ê²°ì¬ì ê´€ë¦¬ í›… | ğŸ†• | `useApproverManagement` | - |

---

## 3. ì»´í¬ë„ŒíŠ¸ ëª…ì„¸

### 3.1 AssessmentDetailHeader (ìˆ˜ì •)

```tsx
interface AssessmentDetailHeaderProps {
  assessmentType: 'initial' | 'adhoc';
  title: string;
  status: 'in_progress' | 'completed';
  onExport: (format: 'pdf' | 'excel') => void;
  onDelete: () => void;
  onEdit?: () => void;           // âœ¨ ìˆ˜ì • ë²„íŠ¼ ì½œë°± ì¶”ê°€
  canEdit: boolean;
}
```

**ìƒíƒœ ë±ƒì§€ ìŠ¤íƒ€ì¼ë§**:
```tsx
// ì‘ì—…ê¸°ê°„ì¤‘ ë±ƒì§€
className="px-3 py-1 text-sm font-medium rounded-full bg-orange-500 text-white"

// ì‘ì—…ì¢…ë£Œ ë±ƒì§€
className="px-3 py-1 text-sm font-medium rounded-full bg-gray-500 text-white"

// ìˆ˜ì • ë²„íŠ¼ (ì‘ì—…ê¸°ê°„ì¤‘ë§Œ)
className="px-4 py-2 text-sm font-medium text-white bg-gradient-to-r from-orange-500 to-orange-600 rounded-lg hover:from-orange-600 hover:to-orange-700"
```

### 3.2 ApprovalLineEditable

**íŒŒì¼**: `src/components/risk-assessment/detail/ApprovalLineEditable.tsx`

```tsx
interface ApprovalLineEditableProps {
  approvers: Approver[];
  onEditClick: () => void;
  canEdit: boolean;
}
```

**ìŠ¤íƒ€ì¼ë§**:
```tsx
// ì„¹ì…˜ í—¤ë”
className="flex items-center justify-between mb-4"

// ì œëª©
className="text-lg font-bold text-slate-800"

// ìˆ˜ì • ì•„ì´ì½˜ ë²„íŠ¼
className="p-2 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer"

// ìŠ¤í¬ë¡¤ ì»¨í…Œì´ë„ˆ
className="flex gap-4 overflow-x-auto py-4 px-2 scrollbar-thin scrollbar-thumb-gray-300"

// ê²°ì¬ì ì¹´ë“œ
className="flex-shrink-0 flex flex-col items-center p-4 bg-white border border-gray-200 rounded-xl min-w-[120px] shadow-sm"

// ì—°ê²°ì„  (â†’)
className="flex-shrink-0 flex items-center text-gray-400"
```

### 3.3 ApproverEditModal

**íŒŒì¼**: `src/components/risk-assessment/detail/ApproverEditModal.tsx`

```tsx
interface ApproverEditModalProps {
  isOpen: boolean;
  onClose: () => void;
  currentApprovers: Approver[];
  onSave: (approvers: Approver[]) => Promise<void>;
}
```

**ìŠ¤íƒ€ì¼ë§**:
```tsx
// ëª¨ë‹¬ ì»¨í…Œì´ë„ˆ
className="bg-white rounded-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-hidden"

// ëª¨ë‹¬ í—¤ë”
className="flex items-center justify-between p-6 border-b border-gray-200"

// ëª¨ë‹¬ ì œëª©
className="text-xl font-bold text-gray-900"

// ë‹«ê¸° ë²„íŠ¼
className="p-2 rounded-lg hover:bg-gray-100"

// í˜„ì¬ ê²°ì¬ ë¼ì¸ ì˜ì—­
className="p-6 bg-gray-50"

// ê²°ì¬ì ì¹´ë“œ (ìˆ˜ì • ëª¨ë“œ)
className="flex items-center gap-2 px-3 py-2 bg-white border border-gray-200 rounded-lg"

// ì‚­ì œ ë²„íŠ¼ (X)
className="p-1 rounded hover:bg-red-100 text-red-500"

// ì¶”ê°€ ë²„íŠ¼ ([+])
className="flex items-center justify-center w-12 h-12 border-2 border-dashed border-gray-300 rounded-lg hover:border-orange-400 cursor-pointer"

// ê²€ìƒ‰ ì˜ì—­
className="p-6 border-t border-gray-200"

// ê²€ìƒ‰ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸
className="max-h-48 overflow-y-auto border border-gray-200 rounded-lg mt-2"

// ê²€ìƒ‰ ê²°ê³¼ ì•„ì´í…œ
className="flex items-center gap-3 p-3 hover:bg-orange-50 cursor-pointer"

// ë²„íŠ¼ ê·¸ë£¹
className="flex gap-3 p-6 border-t border-gray-200"

// ì·¨ì†Œ ë²„íŠ¼
className="flex-1 px-4 py-3 text-gray-700 bg-gray-100 rounded-xl font-medium hover:bg-gray-200"

// ì €ì¥ ë²„íŠ¼
className="flex-1 px-4 py-3 text-white bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl font-medium"
```

### 3.4 ApproverSearchInput

**íŒŒì¼**: `src/components/risk-assessment/detail/ApproverSearchInput.tsx`

```tsx
interface ApproverSearchInputProps {
  onSelect: (user: User) => void;
  excludeIds?: string[];           // ì´ë¯¸ ì„ íƒëœ ê²°ì¬ì ì œì™¸
}
```

**ìŠ¤íƒ€ì¼ë§**:
```tsx
// ê²€ìƒ‰ ì…ë ¥ í•„ë“œ
className="w-full px-4 py-3 pl-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-orange-500"

// ê²€ìƒ‰ ì•„ì´ì½˜
className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"
```

---

## 4. ìƒíƒœ ê´€ë¦¬

### 4.1 useApproverManagement í›…

**íŒŒì¼**: `src/hooks/risk-assessment/useApproverManagement.ts`

```tsx
interface UseApproverManagementReturn {
  approvers: Approver[];
  addApprover: (user: User) => void;
  removeApprover: (approverId: string) => void;
  reorderApprovers: (fromIndex: number, toIndex: number) => void;
  saveApprovers: () => Promise<void>;
  isLoading: boolean;
  canRemove: (approver: Approver) => boolean;  // ì‚­ì œ ê°€ëŠ¥ ì—¬ë¶€
}

function useApproverManagement(
  assessmentId: string,
  initialApprovers: Approver[]
): UseApproverManagementReturn {
  const [approvers, setApprovers] = useState(initialApprovers);

  const canRemove = (approver: Approver) => {
    // ì´ë¯¸ ê²°ì¬ ì™„ë£Œëœ ê²°ì¬ìëŠ” ì‚­ì œ ë¶ˆê°€
    return approver.status !== 'approved';
  };

  const addApprover = (user: User) => {
    const newApprover: Approver = {
      id: user.id,
      name: user.name,
      position: user.position,
      profileImage: user.profileImage,
      status: 'pending',
      order: approvers.length + 1,
    };
    setApprovers([...approvers, newApprover]);
  };

  const removeApprover = (approverId: string) => {
    if (!canRemove(approvers.find(a => a.id === approverId)!)) {
      return;
    }
    setApprovers(approvers.filter(a => a.id !== approverId));
  };

  // ...
}
```

### 4.2 ê²°ì¬ì ê²€ìƒ‰ í›…

```tsx
function useApproverSearch() {
  const [query, setQuery] = useState('');

  const { data: searchResults, isLoading } = useQuery({
    queryKey: ['approver-search', query],
    queryFn: () => searchApprovers(query),
    enabled: query.length >= 2,
  });

  return { query, setQuery, searchResults, isLoading };
}
```

---

## 5. API ì—°ë™

### 5.1 ê²°ì¬ì ëª©ë¡ ìˆ˜ì •

```
PUT /api/risk-assessments/initial/{id}/approvers
```

**Request Body:**
```tsx
interface UpdateApproversRequest {
  approvers: {
    userId: string;
    order: number;
  }[];
}
```

**Response:** `200 OK`
```tsx
interface UpdateApproversResponse {
  success: boolean;
  approvers: {
    id: string;
    userId: string;
    name: string;
    position: string;
    profileImage?: string;
    status: 'pending' | 'approved' | 'rejected';
    order: number;
  }[];
}
```

**í´ë¼ì´ì–¸íŠ¸ í•¨ìˆ˜:**
```tsx
async function updateApprovers(
  assessmentId: string,
  approvers: UpdateApproversRequest['approvers']
): Promise<UpdateApproversResponse> {
  const response = await apiClient.put(
    `/risk-assessments/initial/${assessmentId}/approvers`,
    { approvers }
  );
  return response.data;
}
```

### 5.2 ê²°ì¬ì ê²€ìƒ‰

```
GET /api/users/search?q={keyword}&role=approver
```

**Query Parameters:**
| íŒŒë¼ë¯¸í„° | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… |
|----------|------|:----:|------|
| q | string | âœ… | ê²€ìƒ‰ì–´ (ì´ë¦„, ì§ì±… ë“±) |
| role | string | âœ… | `approver` ê³ ì • |

**Response Schema:**
```tsx
interface SearchApproversResponse {
  users: {
    id: string;
    name: string;
    position: string;
    department: string;
    profileImage?: string;
  }[];
  totalCount: number;
}
```

**í´ë¼ì´ì–¸íŠ¸ í•¨ìˆ˜:**
```tsx
async function searchApprovers(query: string): Promise<SearchApproversResponse> {
  const response = await apiClient.get('/users/search', {
    params: { q: query, role: 'approver' },
  });
  return response.data;
}
```

---

## 6. ìƒíƒœë³„ ë¶„ê¸° ë¡œì§

### 6.1 í˜ì´ì§€ ë ˆë²¨ ë¶„ê¸°

```tsx
function InitialAssessmentDetailPage() {
  const { data } = useInitialAssessmentDetail(id);

  const isEditable = data?.status === 'in_progress';

  return (
    <div>
      <AssessmentDetailHeader
        // ...
        canEdit={isEditable}
        onEdit={isEditable ? handleEdit : undefined}
      />

      {isEditable ? (
        <ApprovalLineEditable
          approvers={data.approvers}
          onEditClick={openApproverModal}
          canEdit={true}
        />
      ) : (
        <ApprovalLineReadonly approvers={data.approvers} />
      )}

      {/* ... */}
    </div>
  );
}
```

---

## 7. êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

### 7.1 ì‹ ê·œ ì»´í¬ë„ŒíŠ¸

- [ ] ApprovalLineEditable
- [ ] ApproverEditModal
- [ ] ApproverSearchInput

### 7.2 ìˆ˜ì • ì»´í¬ë„ŒíŠ¸

- [ ] AssessmentDetailHeader (ìˆ˜ì • ë²„íŠ¼ ì¶”ê°€)
- [ ] InitialAssessmentDetailPage (ìƒíƒœë³„ ë¶„ê¸°)

### 7.3 í›… ë° API

- [ ] useApproverManagement
- [ ] useApproverSearch
- [ ] updateApprovers API
- [ ] searchApprovers API

---

## 8. ì—°ê²° ë¬¸ì„œ

- ê¸°íš ë¬¸ì„œ: `docs/ui-specs/pc/plans/2026-01-16-ìµœì´ˆìœ„í—˜ì„±í‰ê°€ìƒì„¸ë³´ê¸°-ì‘ì—…ê¸°ê°„ì¤‘-ê¸°íš.md`
- ì‘ì—…ì¢…ë£Œ êµ¬í˜„: `docs/ui-specs/pc/specs/2026-01-16-ìµœì´ˆìœ„í—˜ì„±í‰ê°€ìƒì„¸ë³´ê¸°-ì‘ì—…ì¢…ë£Œ-êµ¬í˜„.md`
