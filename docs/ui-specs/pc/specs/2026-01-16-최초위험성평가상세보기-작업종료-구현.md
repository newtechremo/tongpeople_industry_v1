# 최초 위험성평가 상세보기 (작업종료) - 구현 명세서

> **원본**: `C:\hongtong\reference\figma\위험성평가 PC관리자\현장통 2.0 PC 관리자 -위험성평가 문서 상세보기 및 수시 상세보기에서 추가 화면.mp4`
> **생성일**: 2026-01-16
> **플랫폼**: PC (admin-web)
> **문서 유형**: 구현 명세서 (2단계)
> **기획 문서**: `docs/ui-specs/pc/plans/2026-01-16-최초위험성평가상세보기-작업종료-기획.md`

---

## 1. 컴포넌트 구조

### 1.1 파일 구조

```
src/
├── pages/
│   └── risk-assessment/
│       └── InitialAssessmentDetailPage.tsx    # 메인 페이지
├── components/
│   └── risk-assessment/
│       └── detail/
│           ├── AssessmentDetailHeader.tsx     # 헤더 (제목, 상태, 버튼)
│           ├── AssessmentBasicInfo.tsx        # 기본 정보
│           ├── ApprovalLineReadonly.tsx       # 결재 라인 (읽기 전용)
│           ├── RiskFactorCardList.tsx         # 위험요인 카드 목록
│           ├── RiskFactorCard.tsx             # 위험요인 카드
│           ├── ExportDropdown.tsx             # 출력 드롭다운
│           ├── DeleteConfirmModal.tsx         # 삭제 확인 모달
│           └── NoPermissionModal.tsx          # 권한 없음 모달
└── hooks/
    └── risk-assessment/
        └── useInitialAssessmentDetail.ts      # 상세 조회 훅
```

### 1.2 컴포넌트 트리

```
InitialAssessmentDetailPage
├── AssessmentDetailHeader
│   ├── ExportDropdown
│   └── DeleteButton
├── AssessmentBasicInfo
├── ApprovalLineReadonly
│   └── ApproverCard (읽기 전용)
├── RiskFactorCardList
│   └── RiskFactorCard[]
├── DeleteConfirmModal
└── NoPermissionModal
```

---

## 2. 컴포넌트 명세

### 2.1 InitialAssessmentDetailPage

**파일**: `src/pages/risk-assessment/InitialAssessmentDetailPage.tsx`

```tsx
interface InitialAssessmentDetailPageProps {
  // URL params에서 추출
}

// 라우트: /risk-assessment/initial/:id
```

**주요 로직**:
- URL에서 `id` 추출
- `useInitialAssessmentDetail` 훅으로 데이터 조회
- 상태에 따른 UI 분기 (작업종료 vs 작업기간중)

### 2.2 AssessmentDetailHeader

**파일**: `src/components/risk-assessment/detail/AssessmentDetailHeader.tsx`

```tsx
interface AssessmentDetailHeaderProps {
  assessmentType: 'initial' | 'adhoc';
  title: string;
  status: 'in_progress' | 'completed';
  onExport: (format: 'pdf' | 'excel') => void;
  onDelete: () => void;
  canEdit: boolean;
}
```

**스타일링**:
```tsx
// 헤더 컨테이너
className="flex items-center justify-between py-4 border-b border-gray-200"

// 평가 유형 태그
className="px-2 py-1 text-sm font-medium rounded bg-gray-100 text-gray-700"

// 상태 뱃지 - 작업종료
className="px-3 py-1 text-sm font-medium rounded-full bg-gray-500 text-white"

// 버튼 그룹
className="flex items-center gap-2"
```

### 2.3 ExportDropdown

**파일**: `src/components/risk-assessment/detail/ExportDropdown.tsx`

```tsx
interface ExportDropdownProps {
  onExport: (format: 'pdf' | 'excel') => void;
}

const exportOptions = [
  { label: 'PDF로 저장', value: 'pdf' },
  { label: 'Excel로 저장', value: 'excel' },
];
```

**스타일링**:
```tsx
// 드롭다운 버튼
className="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-1"

// 드롭다운 메뉴
className="absolute right-0 mt-2 w-40 bg-white border border-gray-200 rounded-lg shadow-lg z-10"

// 메뉴 아이템
className="px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 cursor-pointer"
```

### 2.4 ApprovalLineReadonly

**파일**: `src/components/risk-assessment/detail/ApprovalLineReadonly.tsx`

```tsx
interface ApprovalLineReadonlyProps {
  approvers: Approver[];
}

interface Approver {
  id: string;
  name: string;
  position: string;
  profileImage?: string;
  status: 'pending' | 'approved' | 'rejected';
  approvedAt?: string;
}
```

**스타일링**:
```tsx
// 스크롤 컨테이너
className="flex gap-4 overflow-x-auto py-4 px-2"

// 결재자 카드
className="flex-shrink-0 flex flex-col items-center p-4 bg-white border border-gray-200 rounded-xl min-w-[120px]"

// 결재 상태 아이콘 - 완료
className="w-6 h-6 text-green-500"

// 결재 상태 아이콘 - 대기
className="w-6 h-6 text-gray-400"
```

### 2.5 RiskFactorCard

**파일**: `src/components/risk-assessment/detail/RiskFactorCard.tsx`

```tsx
interface RiskFactorCardProps {
  subCategory: string;
  riskFactor: string;
  currentMeasures: string;
  riskLevel: 'low' | 'medium' | 'high';
}
```

**스타일링**:
```tsx
// 카드 컨테이너
className="p-6 bg-white border border-gray-200 rounded-xl"

// 소분류 제목
className="text-sm font-medium text-gray-500 mb-4"

// 위험요인 텍스트
className="text-base text-gray-900 mb-4"

// 위험성 수준 뱃지 - 하
className="px-3 py-1 text-sm font-medium rounded-full bg-green-100 text-green-700"

// 위험성 수준 뱃지 - 중
className="px-3 py-1 text-sm font-medium rounded-full bg-yellow-100 text-yellow-700"

// 위험성 수준 뱃지 - 상
className="px-3 py-1 text-sm font-medium rounded-full bg-red-100 text-red-700"
```

### 2.6 DeleteConfirmModal

**파일**: `src/components/risk-assessment/detail/DeleteConfirmModal.tsx`

```tsx
interface DeleteConfirmModalProps {
  isOpen: boolean;
  onClose: () => void;
  onConfirm: () => void;
  isLoading?: boolean;
}
```

**스타일링**:
```tsx
// 모달 오버레이
className="fixed inset-0 bg-black/50 flex items-center justify-center z-50"

// 모달 컨테이너
className="bg-white rounded-2xl p-8 max-w-md w-full mx-4"

// 제목
className="text-xl font-bold text-gray-900 text-center mb-4"

// 메시지
className="text-gray-600 text-center mb-8"

// 버튼 그룹
className="flex gap-3"

// 취소 버튼
className="flex-1 px-4 py-3 text-gray-700 bg-gray-100 rounded-xl font-medium hover:bg-gray-200"

// 삭제 버튼
className="flex-1 px-4 py-3 text-white bg-red-500 rounded-xl font-medium hover:bg-red-600"
```

### 2.7 NoPermissionModal

**파일**: `src/components/risk-assessment/detail/NoPermissionModal.tsx`

```tsx
interface NoPermissionModalProps {
  isOpen: boolean;
  onClose: () => void;
  message?: string;
}
```

**스타일링**:
```tsx
// 모달 컨테이너
className="bg-white rounded-2xl p-8 max-w-sm w-full mx-4 text-center"

// 메시지
className="text-lg text-gray-900 mb-6"

// 확인 버튼
className="px-8 py-3 text-white bg-gray-800 rounded-xl font-medium"
```

---

## 3. 상태 관리

### 3.1 커스텀 훅

**파일**: `src/hooks/risk-assessment/useInitialAssessmentDetail.ts`

```tsx
interface UseInitialAssessmentDetailReturn {
  data: InitialAssessmentDetail | null;
  isLoading: boolean;
  error: Error | null;
  deleteAssessment: () => Promise<void>;
  exportAssessment: (format: 'pdf' | 'excel') => Promise<void>;
}

function useInitialAssessmentDetail(id: string): UseInitialAssessmentDetailReturn {
  // React Query 사용
  const { data, isLoading, error } = useQuery({
    queryKey: ['initial-assessment', id],
    queryFn: () => fetchInitialAssessmentDetail(id),
  });

  const deleteMutation = useMutation({
    mutationFn: () => deleteInitialAssessment(id),
    onSuccess: () => {
      // 목록으로 이동
      navigate('/risk-assessment');
    },
  });

  // ...
}
```

### 3.2 데이터 타입

```tsx
interface InitialAssessmentDetail {
  id: string;
  title: string;
  status: 'in_progress' | 'completed';
  assessmentType: 'initial';
  startDate: string;
  endDate: string;
  createdBy: {
    id: string;
    name: string;
    company: string;
  };
  approvers: Approver[];
  riskFactors: RiskFactorGroup[];
}

interface RiskFactorGroup {
  subCategory: string;
  items: RiskFactorItem[];
}

interface RiskFactorItem {
  id: string;
  riskFactor: string;
  currentMeasures: string;
  riskLevel: 'low' | 'medium' | 'high';
}
```

---

## 4. API 연동

### 4.1 상세 조회

```tsx
// GET /api/risk-assessments/initial/{id}
async function fetchInitialAssessmentDetail(id: string): Promise<InitialAssessmentDetail> {
  const response = await apiClient.get(`/risk-assessments/initial/${id}`);
  return response.data;
}
```

### 4.2 삭제

```tsx
// DELETE /api/risk-assessments/initial/{id}
async function deleteInitialAssessment(id: string): Promise<void> {
  await apiClient.delete(`/risk-assessments/initial/${id}`);
}
```

### 4.3 출력 (다운로드)

```tsx
// GET /api/risk-assessments/initial/{id}/export?format=pdf
async function exportAssessment(id: string, format: 'pdf' | 'excel'): Promise<void> {
  const response = await apiClient.get(
    `/risk-assessments/initial/${id}/export`,
    {
      params: { format },
      responseType: 'blob',
    }
  );

  // 파일 다운로드
  const url = window.URL.createObjectURL(response.data);
  const link = document.createElement('a');
  link.href = url;
  link.download = `위험성평가_${id}.${format === 'pdf' ? 'pdf' : 'xlsx'}`;
  link.click();
}
```

---

## 5. 구현 체크리스트

### 5.1 컴포넌트

- [ ] InitialAssessmentDetailPage
- [ ] AssessmentDetailHeader
- [ ] AssessmentBasicInfo
- [ ] ApprovalLineReadonly
- [ ] RiskFactorCardList
- [ ] RiskFactorCard
- [ ] ExportDropdown
- [ ] DeleteConfirmModal
- [ ] NoPermissionModal

### 5.2 훅 및 API

- [ ] useInitialAssessmentDetail
- [ ] fetchInitialAssessmentDetail
- [ ] deleteInitialAssessment
- [ ] exportAssessment

### 5.3 라우팅

- [ ] `/risk-assessment/initial/:id` 라우트 추가

---

## 6. 연결 문서

- 기획 문서: `docs/ui-specs/pc/plans/2026-01-16-최초위험성평가상세보기-작업종료-기획.md`
