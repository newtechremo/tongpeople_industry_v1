# 통패스(TongPass) 프로젝트 개요

## 1. 서비스 소개

### 1.1 서비스명
**산업현장통 - 통패스 (TongPass)**

### 1.2 서비스 목적
QR 코드 기반 산업현장 출퇴근 관리 서비스로, 건설/제조 현장의 실시간 인원 현황 파악, 고령 근로자 관리, 안전 사고 모니터링을 제공한다.

### 1.3 핵심 가치
- **정확한 인원 파악**: 실시간 출퇴근 현황으로 현장 인원 관리
- **고령자 안전 관리**: 65세 이상 근로자 별도 모니터링
- **캡처 방지 QR**: 시간 기반 동적 QR로 대리 출근 방지
- **간편한 협력업체 관리**: 다수의 협력업체 인원을 통합 관리

### 1.4 타겟 고객
- **규모**: 50인 내외 중소 제조업체 (약 10개 업체, 총 500명)
- **현장**: 제조 공장, 건설 현장

---

## 2. 서비스 구성

| 앱 | 대상 | 플랫폼 | 주요 기능 |
|----|------|--------|-----------|
| **관리자 웹 (admin-web)** | 현장 관리자 | 웹 (React) | 대시보드, QR 스캔, 현장/인원 설정 |
| **근로자 앱 (worker-mobile)** | 현장 근로자 | 모바일 (React Native) | QR 생성, 출퇴근 확인 |

---

## 3. 개발 단계 (Phase)

### Phase 1: MVP (현재)
> 기본 출퇴근 관리 기능

| 기능 | 상태 | 설명 |
|------|------|------|
| 로그인/회원가입 | 🎯 | Supabase Auth |
| 회사/현장/팀 관리 | 🎯 | 기본 CRUD |
| 근로자 등록/관리 | 🎯 | 기본 CRUD |
| QR 출퇴근 (기본) | 🎯 | 30초 갱신, 스캔 |
| 실시간 대시보드 | 🎯 | Supabase Realtime |
| 기본 8시간 자동 퇴근 | 🎯 | Edge Functions |
| 고령자 관리 | 🎯 | 65세 이상 모니터링 |

### Phase 2: 교대 근무 (예정)
> 제조 현장 특화 기능

| 기능 | 상태 | 설명 |
|------|------|------|
| 2교대 (주야간 12시간) | ⏳ | 주간조/야간조 |
| 3교대 (8시간 x 3) | ⏳ | 1번조/2번조/3번조 |
| 야간조 익일 퇴근 처리 | ⏳ | 날짜 변경 로직 |
| 교대 시점 중첩 허용 | ⏳ | 인수인계 시간 |
| 교대 스케줄링 | ⏳ | 외부 스케줄러 연동 |

### Phase 3: AI 확장 (예정)
> AI 기반 자동화

| 기능 | 상태 | 설명 |
|------|------|------|
| 문서 자동화 | ⏳ | 출퇴근 리포트 자동 생성 |
| 이상 탐지 | ⏳ | 비정상 패턴 감지 |

---

## 4. 핵심 기능 (Phase 1)

### 4.1 동적 QR 출퇴근
- 근로자 앱에서 30초마다 갱신되는 QR 코드 생성
- 캡처/스크린샷 사용 불가 (시간 기반 검증)
- 관리자/팀장이 QR 스캔으로 출퇴근 처리

### 4.2 퇴근 정책
| 정책 | 설명 |
|------|------|
| **AUTO_8H** | 출근 시간 기준 8시간 후 자동 퇴근 처리 |
| **MANUAL** | 반드시 QR 스캔으로 퇴근 인증 필요 |

### 4.3 근무일 사이클
- **시작**: 당일 04:00
- **종료**: 익일 03:59
- 야간 작업 시 03:59 이전 출근자는 전일 근무로 집계

### 4.4 대시보드 KPI
| 지표 | 설명 |
|------|------|
| **총 출근** | 현재 출근 중인 인원 (퇴근 미완료) |
| **퇴근율** | 퇴근 완료 인원 / 총 출근 인원 |
| **고령자 비율** | 65세 이상 근로자 / 총 출근 인원 |
| **금일 사고** | 당일 발생한 안전 사고 건수 |

---

## 5. 교대 근무 정책 (Phase 2 예정)

> ⚠️ **이 섹션은 Phase 2에서 구현 예정입니다.**

### 5.1 근무 유형

| 유형 | 설명 | 대상 현장 | 운영 팀 수 |
|------|------|----------|-----------|
| **STANDARD_8H** | 기본 8시간 근무 | 일반 사무, 관리, 단순 노무 | 1개 팀 |
| **TWO_SHIFT** | 2교대 (주야간 12시간) | 대규모 가공, 조립 라인 | 2개 팀 |
| **THREE_SHIFT** | 3교대 (8시간 x 3) | 화학, 제강 등 연속 공정 | 3~4개 팀 |

### 5.2 2교대 근무 (TWO_SHIFT)

| 교대 | 근무 시간 | 설명 |
|------|----------|------|
| **주간조 (DAY)** | 08:00 ~ 20:00 | 당일 출퇴근 |
| **야간조 (NIGHT)** | 20:00 ~ 08:00 | 익일 퇴근 (날짜 변경 처리) |

### 5.3 3교대 근무 (THREE_SHIFT)

| 교대 | 근무 시간 | 설명 |
|------|----------|------|
| **1번조 (SHIFT_1)** | 06:00 ~ 14:00 | 오전조 |
| **2번조 (SHIFT_2)** | 14:00 ~ 22:00 | 오후조 |
| **3번조 (SHIFT_3)** | 22:00 ~ 06:00 | 야간조 (익일 퇴근) |

### 5.4 교대 근무 설정 체계 (예정)

```
현장 (Site)
└── 팀 A ─── 근무정책: STANDARD_8H (사무직)
└── 팀 B ─── 근무정책: TWO_SHIFT (생산1라인)
    └── 교대패턴: DAY (주간조)
└── 팀 C ─── 근무정책: TWO_SHIFT (생산1라인)
    └── 교대패턴: NIGHT (야간조)
└── 팀 D ─── 근무정책: THREE_SHIFT (연속공정)
    └── 교대패턴: SHIFT_1 (1번조)
```

---

## 6. 조직 및 권한 체계

### 6.1 조직 계층 (3단계)
```
회사 (Company)
└── 현장 (Site)              예: 대전공장, 서울본사
    └── 팀 (Team/Partner)    예: 협력A, 협력B
        └── 근로자 (Worker)
```

### 6.2 사용자 역할 (4단계)

| 역할 코드 | 명칭 | 범위 | 주요 권한 |
|-----------|------|------|---------|
| `SUPER_ADMIN` | 최고 관리자 | 회사 전체 | 시스템 전체 설정, 결제, 모든 현장 접근 |
| `SITE_ADMIN` | 현장 관리자 | 특정 현장 | 현장 데이터 관리, 팀/근로자 관리 |
| `TEAM_ADMIN` | 팀 관리자 | 특정 팀 | 팀원 출퇴근 스캔, 팀원 조회 |
| `WORKER` | 근로자 | 본인 | QR 생성, 본인 출퇴근 확인 |

### 6.3 권한 매트릭스

| 기능 | SUPER_ADMIN | SITE_ADMIN | TEAM_ADMIN | WORKER |
|------|:-----------:|:-----------:|:---------:|:------:|
| 회사 설정/결제 | O | X | X | X |
| 현장 추가/삭제 | O | X | X | X |
| 현장 설정 변경 | O | O | X | X |
| 팀(업체) 관리 | O | O | X | X |
| 대시보드 조회 | O | O (본인 현장) | X | X |
| 팀원 QR 스캔 | O | O | O | X |
| 팀원 목록 조회 | O | O | O (본인 팀) | X |
| QR 코드 생성 | X | X | O | O |
| 본인 기록 조회 | O | O | O | O |

---

## 7. 사용자 시나리오

### 7.1 근로자 출근 플로우
1. 근로자가 모바일 앱 실행
2. 동적 QR 코드 표시 (30초마다 갱신)
3. 팀장/관리자가 QR 스캔
4. 출근 시간 자동 기록
5. 대시보드에 실시간 반영

### 7.2 자동 퇴근 (AUTO_8H)
1. 출근 시간 기준 8시간 경과
2. 시스템이 자동으로 퇴근 처리
3. `is_auto_out = true`로 기록

### 7.3 수동 퇴근 (MANUAL)
1. 관리자가 출퇴근 관리 페이지 접속
2. 해당 근로자 선택 후 "퇴근 처리" 클릭
3. 퇴근 시간 수동 입력 또는 현재 시간 적용

---

## 8. 화면 구성

### 8.1 관리자 웹

| 페이지 | 경로 | 주요 기능 |
|--------|------|---------|
| 대시보드 | `/` | KPI 카드, 공지사항, 차트 |
| 근로자 관리 | `/workers` | 근로자 목록, 필터, 상세 정보 |
| 출퇴근 관리 | `/attendance` | 출퇴근 기록, 수동 퇴근 처리 |
| 설정 | `/settings` | 계정, 현장, 협력업체, 관리자 |

### 8.2 근로자 모바일 앱

| 화면 | 주요 기능 |
|------|---------|
| 홈 | QR 코드 표시 (자동 갱신) |
| 출퇴근 기록 | 본인 출퇴근 히스토리 |
| 프로필 | 개인 정보 확인 |

---

## 9. 기술적 특징

### 9.1 기술 스택

| 구분 | 기술 | 용도 |
|------|------|------|
| **백엔드** | Supabase | BaaS (인증, DB, 실시간, 스토리지) |
| **데이터베이스** | PostgreSQL | 관계형 DB (Supabase 내장) |
| **프론트엔드 (웹)** | React + Vite | 관리자 웹 |
| **프론트엔드 (앱)** | React Native + Expo | 근로자 모바일 앱 |
| **실시간** | Supabase Realtime | WebSocket 기반 실시간 동기화 |
| **인증** | Supabase Auth | JWT 기반 인증 |

### 9.2 QR 코드 보안
```typescript
interface QRPayload {
  workerId: string;      // 근로자 ID
  timestamp: number;     // 생성 시각 (Unix)
  expiresAt: number;     // 만료 시각 (30초 후)
  signature: string;     // HMAC 서명 (위변조 방지)
}
```

### 9.3 고령자 판별
- 기준: 만 65세 이상
- 생년월일 기반 자동 계산
- 대시보드에서 별도 집계 및 모니터링

### 9.4 근무일 계산
- 04:00을 기준으로 날짜 구분
- 03:59 이전 출근 = 전일 근무
- 04:00 이후 출근 = 당일 근무

---

## 10. 버전 정보

| 버전 | 날짜 | 주요 변경 |
|------|------|---------|
| v0.1.0 | 2025-12 | 초기 프로젝트 설정, UI 구현, 권한 체계 |

---

## 11. 관련 문서

- [기술 아키텍처](./ARCHITECTURE.md)
- [데이터베이스 설계](./DATABASE.md)
- [개발 가이드](./DEVELOPMENT.md)
- [디자인 가이드라인](./design_guideline_251221.md)
- [근로자 관리 상세](./features/worker-management.md)
- [변경 로그](./CHANGELOG.md)
