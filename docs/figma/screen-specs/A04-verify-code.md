# A04 인증번호 입력 (Verify Code)

> **화면 ID**: A04
> **파일명**: `A04-verify-code.md`
> **상태**: Phase 1 MVP

---

## 1. 기본 정보

| 항목 | 내용 |
|------|------|
| **화면명** | 인증번호 입력 |
| **영문명** | SMS Verification |
| **접근 조건** | SMS 발송 완료 |
| **이전 화면** | A03 전화번호 입력 |
| **다음 화면** | A09 비밀번호 설정 (신규) 또는 홈/참여 회사 목록 (기존 회원) |

---

## 2. 레이아웃 구조

```
┌─────────────────────────────────────┐
│  ←       인증번호 확인               │  ← 헤더
├─────────────────────────────────────┤
│                                     │
│                                     │
│      010-1234-5678로                │
│      인증번호를 전송했습니다          │
│                                     │
│                                     │
│   ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐ ┌───┐   │
│   │ 1 │ │ 2 │ │ 3 │ │ 4 │ │ 5 │ │ 6 │   │  ← 6자리 OTP
│   └───┘ └───┘ └───┘ └───┘ └───┘ └───┘   │
│                                     │
│           02:45 남음                │  ← 타이머
│                                     │
│                                     │
│       인증번호를 받지 못하셨나요?      │
│          [ 재전송 ]                  │
│                                     │
│                                     │
│                                     │
│  ┌─────────────────────────────┐   │
│  │           확인               │   │
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

---

## 3. UI 컴포넌트

### 3.1 안내 텍스트

| 요소 | 스펙 |
|------|------|
| 전화번호 | 16px, Bold, Orange 600 |
| 메시지 | "로 인증번호를 전송했습니다" |
| 폰트 | Body L (16px) |

### 3.2 OTP 입력 필드 (6자리)

| 요소 | 스펙 |
|------|------|
| 개수 | 6개 |
| 각 박스 크기 | 48x56px |
| 간격 | 8px |
| 테두리 | 2px, Gray 300 |
| 모서리 | 12px |
| 폰트 | 24px, Bold, 중앙 |
| 포커스 | border-orange-500 |
| 에러 | border-red-500 |

```tsx
// 자동 포커스 이동
const handleInput = (index: number, value: string) => {
  if (value && index < 5) {
    inputRefs[index + 1].focus();
  }
};
```

### 3.3 타이머

| 요소 | 스펙 |
|------|------|
| 형식 | "MM:SS 남음" |
| 폰트 | 16px, SemiBold |
| 색상 | Slate 600 (1분 미만: Red 600) |
| 초기값 | 03:00 (180초) |

### 3.4 재전송 영역

| 요소 | 스펙 |
|------|------|
| 질문 | "인증번호를 받지 못하셨나요?" (Slate 500) |
| 버튼 | "재전송" (Orange 600, underline) |
| 쿨다운 | 60초 후 활성화 |

### 3.5 확인 버튼

| 상태 | 스펙 |
|------|------|
| 비활성 | 6자리 미만, Gray 200 |
| 활성 | 6자리 입력, Orange Gradient |
| 로딩 | "확인 중..." |

---

## 4. 상태별 UI 변화

### 4.1 Entering

```
입력된 박스: 숫자 표시, border-gray-300
현재 박스: border-orange-500
미입력 박스: 빈 상태
```

### 4.2 Filled

```
모든 박스: 숫자 채워짐
버튼: 활성화
자동 확인: 6자리 입력 시 자동 API 호출 (선택적)
```

### 4.3 Error

```
모든 박스: border-red-500
에러 메시지: "인증번호가 일치하지 않습니다"
입력값: 초기화
```

### 4.4 Expired

```
타이머: "00:00 만료"
버튼: 비활성
안내: "인증번호가 만료되었습니다. 재전송해주세요."
```

---

## 5. 인터랙션

### 5.1 자동 포커스 이동

```
1. 첫 번째 박스 자동 포커스
2. 숫자 입력 시 다음 박스로 이동
3. 백스페이스 시 이전 박스로 이동
4. 6자리 완성 시 키보드 숨김
```

### 5.2 뒤로가기 (인증 완료 전)

```
뒤로가기 버튼 또는 시스템 뒤로가기 시:
  → A03 전화번호 입력 화면으로 이동
  → 전화번호 재입력 가능
```

> **허용 이유:** 아직 인증이 완료되지 않은 상태이므로, 사용자가 전화번호를 잘못 입력했거나 다른 번호로 인증받고 싶을 때 자유롭게 돌아갈 수 있어야 함.

### 5.3 확인 버튼

```
1. API 호출: POST /verify-sms
2. 기존 회원: 홈 또는 참여 회사 목록으로 이동
3. 신규 회원: A09 비밀번호 설정으로 이동 (replace 네비게이션)
4. 선등록 회원: A09로 이동 (데이터 pre-fill, replace 네비게이션)
```

> **중요 (뒤로가기 처리):**
> - 인증 성공 후 A09로 이동 시 **`router.replace()`** 사용
> - A04 화면을 네비게이션 스택에서 제거하여 뒤로가기 시 인증 화면으로 돌아가지 않도록 함
> - A09에서 뒤로가기 시 A03(전화번호 입력)으로 이동됨

```typescript
// 인증 성공 시 네비게이션 예시
const handleVerifySuccess = (response) => {
  if (response.isRegistered) {
    // 기존 회원: 홈 또는 참여 회사 목록으로 이동
    router.replace('/home');
  } else {
    // 신규/선등록 회원: 비밀번호 설정으로 이동 (replace로 스택에서 A04 제거)
    router.replace('/password-setup', {
      phoneNumber,
      preRegisteredData: response.preRegisteredData
    });
  }
};
```

### 5.4 재전송

```
1. 쿨다운 60초 체크
2. API 호출: POST /send-sms
3. 타이머 리셋 (03:00)
4. 토스트: "인증번호가 재전송되었습니다"
```

---

## 6. API 연동

### Request

```typescript
POST /functions/v1/verify-sms

{
  "phoneNumber": "01012345678",
  "code": "123456"
}
```

### Response

```typescript
// 신규 회원
{
  "verified": true,
  "isRegistered": false,
  "preRegisteredData": null
}

// 선등록 회원
{
  "verified": true,
  "isRegistered": false,
  "preRegisteredData": {
    "name": "홍길동",
    "birthDate": "19850315",
    "gender": "M",
    "teamId": "uuid-team",
    "teamName": "(주)정이앤지"
  }
}

// 기존 회원
{
  "verified": true,
  "isRegistered": true,
  "accessToken": "eyJ...",
  "worker": { ... }
}
```

---

## 7. 에러 처리

| 에러 | 메시지 | 처리 |
|------|--------|------|
| `INVALID_CODE` | 인증번호가 일치하지 않습니다 | 입력 초기화 |
| `EXPIRED_CODE` | 인증번호가 만료되었습니다 | 재전송 유도 |
| `MAX_ATTEMPTS` | 시도 횟수를 초과했습니다 | 5분 후 재시도 안내 |

---

## 8. Figma 프레임 목록

| 프레임명 | 설명 |
|----------|------|
| `A04 인증번호 / Default` | 초기 상태 |
| `A04 인증번호 / Entering` | 입력 중 |
| `A04 인증번호 / Filled` | 6자리 완료 |
| `A04 인증번호 / Error` | 오류 상태 |
| `A04 인증번호 / Expired` | 만료 상태 |
| `A04 인증번호 / Loading` | 확인 중 |
