# Q03 스캔 실패 (Scan Failure)

> **화면 ID**: Q03
> **파일명**: `Q03-scan-failure.md`
> **상태**: Phase 1 MVP

---

## 1. 기본 정보

| 항목 | 내용 |
|------|------|
| **화면명** | 스캔 실패 |
| **영문명** | Scan Failure |
| **접근 조건** | QR 스캔 실패 후 |
| **이전 화면** | Q01 QR 스캔 |
| **복귀 방법** | 버튼 터치 또는 3초 자동 |

---

## 2. 레이아웃 구조

```
┌─────────────────────────────────────┐
│                                     │
│                                     │
│                                     │
│              ✕                      │  ← 실패 아이콘
│                                     │
│         스캔에 실패했습니다           │  ← 메인 메시지
│                                     │
│  ┌─────────────────────────────┐   │
│  │                             │   │
│  │    ⚠ QR 코드가 만료되었습니다  │   │  ← 에러 상세
│  │                             │   │
│  │    근로자에게 QR 코드를        │   │
│  │    새로 갱신해달라고           │   │
│  │    요청해주세요.              │   │
│  │                             │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │         다시 스캔하기         │   │
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

---

## 3. UI 컴포넌트

### 3.1 실패 아이콘

```
           ✕

아이콘: XCircle (Lucide)
크기: 80x80
색상: Red 500
배경: Red 50 (원형, 120x120)
애니메이션:
  - 스케일 0 → 1 (바운스)
  - 좌우 흔들림 (shake)
```

### 3.2 메인 메시지

```
   스캔에 실패했습니다

폰트: H2 (24px, Bold)
색상: Slate 800
정렬: 중앙
```

### 3.3 에러 상세 카드

```
┌─────────────────────────────────────┐
│                                     │
│   ⚠ QR 코드가 만료되었습니다         │  ← 에러 제목
│                                     │
│   근로자에게 QR 코드를 새로           │  ← 해결 방법
│   갱신해달라고 요청해주세요.          │
│                                     │
└─────────────────────────────────────┘

배경: Red 50
테두리: Red 200
모서리: 16px
패딩: 20px

아이콘: AlertTriangle, Amber 500, 20px
에러 제목: 16px, SemiBold, Red 700
해결 방법: 14px, Regular, Slate 600
줄 간격: 8px
```

### 3.4 다시 스캔하기 버튼

```
┌─────────────────────────────────────┐
│          다시 스캔하기               │
└─────────────────────────────────────┘

타입: Primary
배경: Slate 800 (또는 Orange Gradient)
텍스트: White, 16px, Bold
크기: 전체 너비 - 32px 양쪽 패딩
높이: 52px
모서리: 12px
```

---

## 4. 에러 유형별 메시지

### 4.1 QR 만료

```
에러 코드: QR_EXPIRED

┌─────────────────────────────────────┐
│   ⚠ QR 코드가 만료되었습니다         │
│                                     │
│   근로자에게 QR 코드를 새로           │
│   갱신해달라고 요청해주세요.          │
└─────────────────────────────────────┘
```

### 4.2 이미 출근함

```
에러 코드: ALREADY_CHECKED_IN

┌─────────────────────────────────────┐
│   ⚠ 이미 출근한 근로자입니다         │
│                                     │
│   홍길동님은 오늘 09:00에            │
│   이미 출근 처리되었습니다.           │
└─────────────────────────────────────┘
```

### 4.3 출근 기록 없음 (퇴근 시)

```
에러 코드: NOT_CHECKED_IN

┌─────────────────────────────────────┐
│   ⚠ 출근 기록이 없습니다             │
│                                     │
│   홍길동님은 오늘 출근 기록이         │
│   없어 퇴근 처리할 수 없습니다.       │
└─────────────────────────────────────┘
```

### 4.4 권한 없음

```
에러 코드: NO_PERMISSION

┌─────────────────────────────────────┐
│   ⚠ 스캔 권한이 없습니다             │
│                                     │
│   해당 근로자는 다른 팀 소속으로       │
│   스캔할 수 없습니다.                │
└─────────────────────────────────────┘
```

### 4.5 근로자 없음

```
에러 코드: WORKER_NOT_FOUND

┌─────────────────────────────────────┐
│   ⚠ 근로자를 찾을 수 없습니다        │
│                                     │
│   등록되지 않은 근로자이거나           │
│   QR 코드가 유효하지 않습니다.        │
└─────────────────────────────────────┘
```

### 4.6 유효하지 않은 QR

```
에러 코드: INVALID_SIGNATURE

┌─────────────────────────────────────┐
│   ⚠ 유효하지 않은 QR 코드입니다      │
│                                     │
│   인식된 QR 코드가 올바른             │
│   출퇴근용 QR이 아닙니다.            │
└─────────────────────────────────────┘
```

### 4.7 이미 퇴근함

```
에러 코드: ALREADY_CHECKED_OUT

┌─────────────────────────────────────┐
│   ⚠ 이미 퇴근한 근로자입니다         │
│                                     │
│   홍길동님은 오늘 18:00에            │
│   이미 퇴근 처리되었습니다.           │
└─────────────────────────────────────┘
```

### 4.8 네트워크 오류

```
에러 코드: NETWORK_ERROR

┌─────────────────────────────────────┐
│   ⚠ 네트워크 연결 오류               │
│                                     │
│   인터넷 연결을 확인한 후             │
│   다시 시도해주세요.                 │
└─────────────────────────────────────┘
```

---

## 5. 애니메이션

### 5.1 진입 애니메이션

```typescript
// 실패 아이콘
const iconAnimation = {
  scale: [0, 1.2, 1],
  rotate: [0, -10, 10, -5, 5, 0],  // shake
  duration: 600,
};

// 카드 슬라이드업
const cardAnimation = {
  translateY: [30, 0],
  opacity: [0, 1],
  duration: 300,
  delay: 200,
};
```

### 5.2 진동 피드백

```typescript
// 실패 시 진동 (더 강함)
Haptics.notificationAsync(
  Haptics.NotificationFeedbackType.Error
);
```

---

## 6. 상태별 UI

### 6.1 일반 에러

```
- 빨간색 X 아이콘
- 에러 메시지 카드
- 다시 스캔하기 버튼
```

### 6.2 권한 에러

```
- 빨간색 X 아이콘
- 에러 메시지 카드
- "확인" 버튼 (스캔 화면으로 복귀)
```

### 6.3 네트워크 에러

```
- 빨간색 X 아이콘
- 에러 메시지 카드
- "다시 시도" 버튼 (재요청)
```

---

## 7. 인터랙션

### 7.1 다시 스캔하기

```
1. 버튼 터치
2. Q01 (QR 스캔) 화면으로 즉시 전환
3. 이전 모드 유지 (출근/퇴근)
```

### 7.2 자동 복귀 (선택적)

```
- 3초 후 자동으로 Q01로 복귀
- 연속 스캔 시 편의성 제공
- 카운트다운 표시: "3초 후 자동으로 닫힙니다"
```

### 7.3 화면 터치

```
- 화면 아무 곳이나 터치 시 Q01로 이동
- 빠른 재시도 지원
```

---

## 8. 데이터

```typescript
interface ScanFailureData {
  errorCode:
    | 'QR_EXPIRED'
    | 'INVALID_SIGNATURE'
    | 'ALREADY_CHECKED_IN'
    | 'ALREADY_CHECKED_OUT'
    | 'NOT_CHECKED_IN'
    | 'NO_PERMISSION'
    | 'WORKER_NOT_FOUND'
    | 'NETWORK_ERROR';
  errorMessage: string;
  workerName?: string;
  time?: string;
}
```

---

## 9. 디자인 토큰

```tsx
// 실패 색상
const failureColors = {
  icon: 'text-red-500',
  iconBg: 'bg-red-50',
  cardBg: 'bg-red-50',
  cardBorder: 'border-red-200',
  title: 'text-red-700',
  description: 'text-slate-600',
};

// 아이콘 크기
const iconSize = {
  container: 120,
  icon: 80,
};

// 에러 카드 스타일
const errorCard = {
  backgroundColor: '#FEF2F2', // red-50
  borderRadius: 16,
  padding: 20,
  borderWidth: 1,
  borderColor: '#FECACA', // red-200
};

// 애니메이션 타이밍
const timing = {
  iconShake: 600,
  cardSlide: 300,
  autoClose: 3000,  // 선택적
};
```

---

## 10. 접근성

```
- 에러 메시지 스크린 리더 지원
- 강한 진동 피드백으로 실패 인지
- 충분한 색상 대비 (Red on White)
- 큰 터치 영역 (버튼)
- 명확한 해결 방법 안내
```

---

## 11. Figma 프레임 목록

| 프레임명 | 설명 |
|----------|------|
| `Q03 스캔실패 / QRExpired` | QR 만료 |
| `Q03 스캔실패 / AlreadyCheckedIn` | 이미 출근 |
| `Q03 스캔실패 / NotCheckedIn` | 출근 기록 없음 |
| `Q03 스캔실패 / NoPermission` | 권한 없음 |
| `Q03 스캔실패 / InvalidQR` | 유효하지 않은 QR |
| `Q03 스캔실패 / NetworkError` | 네트워크 오류 |
