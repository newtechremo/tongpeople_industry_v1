# M02 홈 - 근무 중 (Home Working)

> **화면 ID**: M02
> **파일명**: `M02-home-working.md`
> **상태**: Phase 1 MVP

---

## 1. 기본 정보

| 항목 | 내용 |
|------|------|
| **화면명** | 홈 - 근무 중 |
| **영문명** | Home - Working |
| **접근 조건** | status == 'ACTIVE' && commuteStatus == 'WORK_ON' |
| **하단 탭** | 홈 (활성) |

---

## 2. 레이아웃 구조

```
┌─────────────────────────────────────┐
│  [로고]                      [알림]  │  ← 헤더
├─────────────────────────────────────┤
│                                     │
│  안녕하세요, 홍길동님                 │
│  오늘도 안전한 하루 되세요!           │
│                                     │
│  ┌─────────────────────────────┐   │
│  │                             │   │
│  │     2026년 1월 13일 (월)     │   │
│  │                             │   │
│  │  ┌───────────────────────┐  │   │
│  │  │     ▓▓▓▓▓▓▓▓▓▓▓       │  │   │
│  │  │     ▓▓ QR CODE ▓▓     │  │   │  ← QR 코드
│  │  │     ▓▓▓▓▓▓▓▓▓▓▓       │  │   │
│  │  └───────────────────────┘  │   │
│  │                             │   │
│  │         00:28 남음          │   │  ← 타이머
│  │                             │   │
│  │       ┌───────────┐         │   │
│  │       │  퇴근하기  │         │   │  ← 퇴근 버튼
│  │       └───────────┘         │   │
│  │                             │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │  오늘의 근무                  │   │
│  │  ─────────────────────────── │   │
│  │  출근     09:00              │   │
│  │  퇴근     --:--              │   │
│  │  ─────────────────────────── │   │
│  │  근무시간  3시간 24분          │   │
│  └─────────────────────────────┘   │
│                                     │
├─────────────────────────────────────┤
│  홈    출퇴근    [QR]     MY       │
└─────────────────────────────────────┘
```

---

## 3. UI 컴포넌트

### 3.1 QR 코드 영역

```
  ┌───────────────────────────┐
  │                           │
  │      ▓▓▓▓▓▓▓▓▓▓▓▓         │
  │      ▓▓ QR CODE ▓▓        │
  │      ▓▓▓▓▓▓▓▓▓▓▓▓         │
  │                           │
  └───────────────────────────┘

크기: 200x200 (QR 자체)
테두리: 8px White
배경: White
그림자: shadow-lg
모서리: 16px
```

### 3.2 QR 갱신 타이머

```
         00:28 남음

폰트: 18px, SemiBold
색상: Orange 600
애니메이션: 매초 업데이트
10초 미만: Red 600 (경고)
```

### 3.3 QR 코드 갱신 로직

```typescript
// QR 페이로드
interface QRPayload {
  workerId: string;
  timestamp: number;      // 생성 시각
  expiresAt: number;      // 만료 시각 (30초 후)
  signature: string;      // HMAC 서명
}

// 30초마다 갱신
useEffect(() => {
  const interval = setInterval(() => {
    generateNewQR();
  }, 30000);
  return () => clearInterval(interval);
}, []);
```

### 3.4 퇴근하기 버튼

```
      ┌─────────────────────┐
      │      퇴근하기        │
      └─────────────────────┘

크기: 200x48 (또는 전체 너비의 60%)
배경: Red Gradient (from-red-500 to-red-600)
텍스트: White, 16px, Bold
모서리: 12px
```

### 3.5 오늘의 근무 카드 (업데이트)

```
┌─────────────────────────────────────┐
│  오늘의 근무                         │
│  ───────────────────────────────── │
│  출근     09:00                     │  ← 실제 출근 시간
│  퇴근     --:--                     │
│  ───────────────────────────────── │
│  근무시간  3시간 24분                 │  ← 실시간 계산
└─────────────────────────────────────┘

근무시간: 출근 시간부터 현재까지 실시간 계산
색상: Orange 600 (강조)
```

---

## 4. 상태별 UI

### 4.1 WORK_ON (근무 중) - 현재 화면

```
- QR 코드 표시
- 타이머 카운트다운
- 빨간색 "퇴근하기" 버튼
- 실시간 근무시간 표시
```

### 4.2 QR 갱신 중

```
- QR 코드 페이드아웃
- 새 QR 코드 페이드인
- 타이머 30초로 리셋
```

---

## 5. 인터랙션

### 5.1 QR 코드 자동 갱신

```
1. 30초 카운트다운
2. 0초 도달 시:
   - 새 QR 생성
   - 애니메이션 전환
   - 타이머 리셋
3. 10초 미만: 타이머 빨간색
```

### 5.2 퇴근하기 버튼

```
1. 터치 시 확인 팝업
2. 팝업 내용:
   "퇴근하시겠습니까?
    퇴근 후 오늘은 재출근이 불가합니다."
3. [확인] 시:
   - API 호출: POST /commute-out
   - 성공: M03 (퇴근 완료) 화면으로 전환
4. [취소] 시: 팝업 닫기
```

### 5.3 퇴근 확인 팝업

```
┌─────────────────────────────────────┐
│                                     │
│         퇴근하시겠습니까?            │
│                                     │
│   ⚠ 퇴근 후 오늘은 재출근이           │
│      불가합니다.                     │
│                                     │
│    [ 취소 ]       [ 확인 ]          │
│                                     │
└─────────────────────────────────────┘

경고 아이콘: AlertTriangle, Amber 500
경고 텍스트: Slate 600
```

---

## 6. API 연동

### 퇴근 Request

```typescript
POST /functions/v1/commute-out

{
  "attendanceId": "uuid-attendance"
}
```

### Response

```typescript
{
  "success": true,
  "checkOutTime": "2026-01-13T18:00:00+09:00",
  "totalWorkMinutes": 540
}
```

---

## 7. QR 코드 생성

```typescript
import QRCode from 'react-native-qrcode-svg';
import CryptoJS from 'crypto-js';

const generateQRPayload = () => {
  const timestamp = Date.now();
  const expiresAt = timestamp + 30000; // 30초 후

  const payload = {
    workerId: userId,
    timestamp,
    expiresAt,
  };

  const signature = CryptoJS.HmacSHA256(
    JSON.stringify(payload),
    SECRET_KEY
  ).toString();

  return JSON.stringify({ ...payload, signature });
};

// 렌더링
<QRCode
  value={qrPayload}
  size={200}
  backgroundColor="white"
/>
```

---

## 8. Figma 프레임 목록

| 프레임명 | 설명 |
|----------|------|
| `M02 홈 근무중 / Default` | QR 표시, 정상 상태 |
| `M02 홈 근무중 / TimerWarning` | 10초 미만 경고 |
| `M02 홈 근무중 / QRRefresh` | QR 갱신 중 |
| `M02 홈 근무중 / CheckoutPopup` | 퇴근 확인 팝업 |
