산업현장 출퇴근 관리 서비스 **'산업현장통(통패스)'** 위한 **제품 요구사항 정의서(PRD)**와 **데이터베이스(DB) 설계안**입니다.

## 1. 제품 요구사항 정의서 (PRD)

### **[프로젝트 개요]**

* **서비스명:** 산업현장통 (모듈명: 통패스)
* **목적:** QR 코드 기반의 실시간 출퇴근 관리 및 고령 근로자/안전 사고 현황 모니터링을 통한 현장 안전 관리 효율화.
* **핵심 가치:** "복잡한 기록 없이 스캔 한 번으로 끝나는 현장 관리"
* **대상: 건설 및 제조 산업 현장 관리자 및 근로자.
* **디자인 가이드라인은 'design_guidline_251221.md' 파일 참고해줘

2. 사용자 역할 및 프로세스
근로자: 스마트폰 앱을 통해 본인의 고유 QR 코드를 생성하고 현장에 진입/이탈 시 인증합니다.
현장 관리자: 전용 리더기(앱)로 근로자의 QR을 스캔하며, 현장 설정에 따라 퇴근 방식을 관리합니다.
시스템: 수집된 데이터를 바탕으로 실시간 대시보드(인원 현황, 고령자 비율, 퇴근율 등)를 생성합니다.

### **[핵심 기능 요구사항]**

#### **1) 출근 관리 (통패스)**

* **동적 QR 생성 (근로자):** 캡처 방지를 위해 일정 시간마다 갱신되는 QR 코드 생성.
* ** QR 스캔 인증: 관리자가 근로자의 Dynamic QR(보안 강화형)을 스캔하여 출근 처리합니다.
* **QR 스캐닝 (관리자):** 관리자 앱 내 카메라를 통해 근로자 QR 인식 및 즉시 체크인 처리.
* **중복 출근 방지: 동일한 '근무일(Working Date)' 내에 이미 출근 기록이 있고 퇴근 처리가 되지 않은 경우 알림을 표시합니다.

#### **2) 퇴근 관리 (통패스)*
현장 설정(Site Policy)에 따라 아래 두 가지 모드 중 하나를 선택적으로 적용합니다.

모드 1: 8시간 자동 퇴근 (Auto-8H Mode)
로직: 출근 스캔이 완료되는 시점에 시스템이 자동으로 출근 시간 + 8시간을 퇴근 예정 시간으로 확정 기록합니다.
활용: 별도의 퇴근 체크가 어려운 광범위한 현장이나 단순 노무 현장에서 사용합니다.

모드 2: 수동 퇴근 인증 (Manual Mode)
로직: 근로자가 직접 앱에서 '퇴근 버튼'을 누르거나, 관리자가 퇴근 QR을 다시 스캔해야만 퇴근 시간이 기록됩니다.
활용: 연장 근로가 잦거나 정확한 공수 산정이 필요한 현장에서 사용합니다.

#### **3) 일 단위 사이클 및 재출근 로직
근무일(Working Date) 정의: 당일 04:00 ~ 익일 03:59까지를 하나의 근무일로 정의(현장 상황에 따라 조정 가능)합니다.
익일 재출근: 날짜가 바뀌면 이전 기록과 상관없이 새로운 출근 로그를 생성합니다.
미퇴근자 처리 (수동 모드 시): 수동 모드에서 당일 자정까지 퇴근 기록이 없는 경우, 시스템이 지정된 시간(예: 현장 종료 시간)에 강제 퇴근 처리하고 '미퇴근 자동처리' 플래그를 남깁니다.

#### **4) 관리자 설정 요구사항 (Admin Settings)
현장별 정책 설정:
- 퇴근 모드 선택 (자동 8시간 / 수동) 기능을 제공합니다.
- 자동 퇴근 모드 선택 시 '기준 시간'을 수정 가능하게 합니다 (기본 8시간).

실시간 모니터링:
- 총 출근 현황: 관리자/근로자 수 실시간 집계.
- 고령자 관리: 생년월일 기준 만 65세 이상 인원 자동 분류 및 집중 관리.
- 퇴근율 지표: 출근 인원 중 퇴근 처리가 완료된 비율 계산(100% 목표).
- 소속별 인원 분포: 팀(협력업체)별 투입 인원 막대그래프 시각화.



## 2. 데이터베이스(DB) 테이블 구조
제공해주신 대시보드 중심의 데이터 구조를 적극 반영하여, **현장 관리 로직(자동/수동 퇴근)**과 **데이터 분석 효율성**을 모두 잡은 **최종 DB 설계안 및 PRD**를 정리해 드립니다.

사용자님께서 주신 구조는 '리포팅(보고)'에 최적화된 구조(Denormalized)입니다. 이를 기반으로 실제 운영에 필요한 설정값들을 병합했습니다.

---

## 1. 최종 데이터베이스(DB) 테이블 구조

### **(1) Master: 현장 및 협력사 테이블**

현장별로 퇴근 정책을 다르게 가져가야 하므로 `sites` 테이블에 설정값을 포함합니다.

| 테이블 | 컬럼명 | 타입 | 설명 |
| --- | --- | --- | --- |
| **sites** | `id` | INT (PK) | 현장 고유 ID |
|  | `name` | VARCHAR | 현장명 (예: 경희대학교 학생회관) |
|  | **`checkout_policy`** | ENUM | **퇴근 정책 (AUTO_8H, MANUAL)** |
|  | **`auto_hours`** | INT | 자동 퇴근 기준 시간 (기본값 8) |
| **partners** | `id` | INT (PK) | 협력업체 고유 ID |
|  | `name` | VARCHAR | 협력업체명 (예: (주)정이앤지) |

---

### **(2) Attendance: 통합 출퇴근 로그 테이블**

대시보드에서 즉시 쿼리할 수 있도록 **근로자 정보(나이, 고령 여부)**와 **사고 여부**를 한 레코드에 담는 구조입니다.

| 컬럼명 | 타입 | 설명 |
| --- | --- | --- |
| `id` | INT (PK) | 로그 고유 ID |
| `work_date` | DATE | 작업일 (재출근 판별 기준) |
| `site_id` | INT (FK) | 현장 ID |
| `partner_id` | INT (FK) | 협력업체 ID |
| `worker_name` | TEXT | 근로자 성명 |
| `role` | TEXT | '관리자' 또는 '근로자' |
| `birth_date` | DATE | 생년월일 |
| `age` | INTEGER | 나이 (출근 시점 기준 계산값) |
| **`is_senior`** | BOOLEAN | **65세 이상 여부 (대시보드 고령자 수 산출)** |
| `check_in_time` | TIME | 출근 시간 |
| `check_out_time` | TIME | 퇴근 시간 (미퇴근 시 NULL) |
| **`is_auto_out`** | BOOLEAN | **자동 퇴근 처리 여부 (8시간 모드 적용 시 True)** |
| **`has_accident`** | BOOLEAN | **사고 발생 여부 (대시보드 사고 건수 산출)** |
