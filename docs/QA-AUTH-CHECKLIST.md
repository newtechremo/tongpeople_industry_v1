# TongPass 인증 시스템 QA 체크리스트

## 1. 인증 플로우 분석 결과

### 1.1 아키텍처 개요

```
Frontend (admin-web)          Backend (Supabase Edge Functions)
      |                                    |
      +-- LoginPage.tsx                    |
      +-- onboarding/Step1Personal.tsx     |
      +-- api/auth.ts -----------------> send-sms/index.ts
                                          verify-sms/index.ts
                                          signup/index.ts
                                          login/index.ts
                                          reset-password/index.ts
```

### 1.2 핵심 파일 위치

| 기능 | 프론트엔드 | 백엔드 |
|------|-----------|--------|
| 로그인 | `/apps/admin-web/src/pages/LoginPage.tsx` | `/backend/supabase/functions/login/index.ts` |
| 회원가입 | `/apps/admin-web/src/pages/onboarding/Step1Personal.tsx` ~ `Step4Password.tsx` | `/backend/supabase/functions/signup/index.ts` |
| SMS 발송 | `/apps/admin-web/src/api/auth.ts` | `/backend/supabase/functions/send-sms/index.ts` |
| SMS 인증 | `/apps/admin-web/src/api/auth.ts` | `/backend/supabase/functions/verify-sms/index.ts` |
| 비밀번호 재설정 | `/apps/admin-web/src/pages/PasswordResetPage.tsx` | `/backend/supabase/functions/reset-password/index.ts` |

### 1.3 인증 흐름

#### 회원가입 (4단계)
1. **Step1 - 본인 인증**: 이름 + 휴대폰 SMS 인증 + 약관 동의
2. **Step2 - 회사 정보**: 회사명, 사업자등록번호, 대표자명, 주소
3. **Step3 - 현장 정보**: 첫 번째 현장 이름, 주소
4. **Step4 - 비밀번호**: 비밀번호 설정

#### 로그인
1. 휴대폰 번호 + 비밀번호 입력
2. Edge Function에서 users 테이블 조회
3. Supabase Auth로 로그인 (fake email 방식: `{phone}@phone.tongpass.local`)
4. 세션 토큰 발급 및 저장

---

## 2. QA 테스트 체크리스트

### 2.1 회원가입 테스트 케이스

#### TC-SIGNUP-001: 정상 회원가입 플로우
- [ ] Step1: 이름 입력
- [ ] Step1: 휴대폰 번호 입력 (010-xxxx-xxxx 형식)
- [ ] Step1: 인증번호 발송 버튼 클릭
- [ ] Step1: SMS 인증번호 수신 확인
- [ ] Step1: 인증번호 6자리 입력 및 확인
- [ ] Step1: 필수 약관 동의
- [ ] Step2: 회사 정보 입력 (회사명, 사업자번호, 대표자, 주소)
- [ ] Step3: 현장 정보 입력 (현장명)
- [ ] Step4: 비밀번호 설정 (8자 이상, 영문+숫자+특수문자)
- [ ] 가입 완료 후 로그인 페이지로 이동

#### TC-SIGNUP-002: 중복 휴대폰 번호
- [ ] 이미 가입된 휴대폰 번호로 인증번호 요청
- [ ] "이미 가입된 휴대폰 번호입니다." 에러 메시지 확인

#### TC-SIGNUP-003: 중복 사업자등록번호
- [ ] 이미 등록된 사업자번호 입력
- [ ] "이미 등록된 사업자등록번호입니다." 에러 메시지 확인

#### TC-SIGNUP-004: 인증번호 오류
- [ ] 잘못된 인증번호 5회 입력
- [ ] "인증 시도 횟수를 초과했습니다" 에러 확인
- [ ] 인증번호 재발송 후 정상 인증

#### TC-SIGNUP-005: 인증번호 만료
- [ ] 인증번호 발송 후 3분 대기
- [ ] "인증코드가 만료되었습니다" 에러 확인

#### TC-SIGNUP-006: 잘못된 전화번호 형식
- [ ] 10자리 미만 번호 입력
- [ ] 02로 시작하는 번호 입력
- [ ] "올바른 휴대폰 번호를 입력해주세요" 에러 확인

#### TC-SIGNUP-007: 필수 약관 미동의
- [ ] 필수 약관 체크 안함
- [ ] 다음 버튼 비활성화 확인

#### TC-SIGNUP-008: 비밀번호 정책 검증
- [ ] 7자 이하 비밀번호 입력 시 에러
- [ ] 영문만 입력 시 에러
- [ ] 숫자만 입력 시 에러
- [ ] 특수문자 없이 입력 시 에러
- [ ] 비밀번호 확인 불일치 시 에러

---

### 2.2 로그인 테스트 케이스

#### TC-LOGIN-001: 정상 로그인
- [ ] 등록된 휴대폰 번호 입력
- [ ] 올바른 비밀번호 입력
- [ ] 로그인 성공 후 대시보드 이동

#### TC-LOGIN-002: 잘못된 비밀번호
- [ ] 등록된 휴대폰 번호 + 잘못된 비밀번호
- [ ] "비밀번호가 일치하지 않습니다" 에러 확인

#### TC-LOGIN-003: 미등록 휴대폰 번호
- [ ] 등록되지 않은 번호로 로그인 시도
- [ ] "등록되지 않은 휴대폰 번호입니다" 에러 확인

#### TC-LOGIN-004: 비활성화된 계정
- [ ] is_active = false인 계정으로 로그인
- [ ] "비활성화된 계정입니다" 에러 확인

#### TC-LOGIN-005: 권한 없는 사용자 (근로자)
- [ ] role = 'WORKER' 또는 'TEAM_ADMIN'인 계정으로 로그인
- [ ] "관리자 권한이 없습니다" 에러 확인

#### TC-LOGIN-006: 세션 유지
- [ ] 로그인 후 브라우저 새로고침
- [ ] 세션 유지 확인

#### TC-LOGIN-007: 로그아웃
- [ ] 로그아웃 버튼 클릭
- [ ] 로그인 페이지로 리다이렉트
- [ ] 보호된 페이지 접근 시 로그인 페이지로 이동

---

### 2.3 비밀번호 재설정 테스트 케이스

#### TC-RESET-001: 정상 비밀번호 재설정
- [ ] 등록된 휴대폰 번호 입력
- [ ] SMS 인증 완료
- [ ] 새 비밀번호 설정
- [ ] 새 비밀번호로 로그인 성공

#### TC-RESET-002: 미등록 번호로 재설정 요청
- [ ] 등록되지 않은 번호로 SMS 요청
- [ ] "등록되지 않은 휴대폰 번호입니다" 에러 확인

---

### 2.4 SMS 인증 테스트 케이스

#### TC-SMS-001: 인증번호 발송
- [ ] 유효한 번호로 발송 요청
- [ ] 3분 타이머 시작 확인
- [ ] SMS 수신 확인 (또는 개발모드에서 콘솔 확인)

#### TC-SMS-002: 인증번호 재발송
- [ ] 재발송 버튼 클릭
- [ ] 기존 코드 무효화 확인
- [ ] 새 코드 발송 확인

#### TC-SMS-003: 인증 시도 횟수 제한
- [ ] 5회 틀린 코드 입력
- [ ] 추가 시도 차단 확인
- [ ] 재발송 후 정상 동작

---

## 3. 에러 메시지 매핑

| 상황 | 에러 메시지 (Korean) |
|------|---------------------|
| 중복 휴대폰 번호 (회원가입) | "이미 가입된 휴대폰 번호입니다." |
| 미등록 휴대폰 번호 (로그인) | "등록되지 않은 휴대폰 번호입니다." |
| 잘못된 비밀번호 | "비밀번호가 일치하지 않습니다." |
| 비활성화 계정 | "비활성화된 계정입니다. 관리자에게 문의하세요." |
| 관리자 권한 없음 | "관리자 권한이 없습니다. 근로자 앱을 이용해주세요." |
| 인증 코드 불일치 | "인증코드가 일치하지 않습니다. (N회 남음)" |
| 인증 코드 만료 | "인증코드가 만료되었습니다. 다시 요청해주세요." |
| 인증 시도 초과 | "인증 시도 횟수를 초과했습니다. 인증코드를 다시 요청해주세요." |
| 중복 사업자번호 | "이미 등록된 사업자등록번호입니다." |
| 인증 토큰 만료 | "인증이 만료되었습니다. 처음부터 다시 진행해주세요." |

---

## 4. 테스트 데이터

### 정상 테스트 계정
```
이메일: ekbae8765@gmail.com
휴대폰: 010-9510-6236
비밀번호: a123123@
이름: 배은경
회사명: 리모
```

### 테스트용 계정 생성 시 필요 정보
```
이름: 테스트관리자
휴대폰: 010-0000-0001
비밀번호: Test1234!
회사명: 테스트회사
사업자등록번호: 123-45-67890
대표자명: 홍길동
주소: 서울시 강남구
현장명: 테스트현장
```

---

## 5. 개발 환경 특이사항

### SMS 인증번호 확인 방법
1. **개발 환경**: 브라우저 콘솔에 `[DEV] SMS 인증번호: XXXXXX` 출력
2. **API 응답**: `ENVIRONMENT !== 'production'`일 때 응답에 `code` 필드 포함
3. **Edge Function 로그**: Supabase 대시보드 > Edge Functions > Logs

### 인증 토큰 구조
```javascript
// verificationToken은 Base64 인코딩된 JSON
{
  phone: "01012345678",
  purpose: "SIGNUP",
  verifiedAt: 1705000000000,
  expiresAt: 1705000600000  // 10분 유효
}
```
